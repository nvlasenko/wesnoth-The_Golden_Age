#textdomain wesnoth-units

[unit_type]
    id=Troll Bombardier
    name= _ "Troll Bombardier"
    race=troll
    image="units/trolls/bombardier.png"
    profile=portraits/trolls/troll-rocklobber.png
    {MAGENTA_IS_THE_TEAM_COLOR}
    hitpoints=75
    movement_type=largefoot
    movement=5
    experience=200
    level=4
    alignment=chaotic
    advances_to=null
    {AMLA_DEFAULT}
    undead_variation=troll
    cost=65
    usage=mixed fighter
    description= _ "Your horse slowly trots up the long mountain trail, another long day in your journey. Then suddenly you hear a roar and from the mountains above you a giagantic boulder comes rolling and tumbling downwards, then an entire avalanche follows. Rocks rip everything apart, destroying the path and decimating the mountain side. No one ever finds your body. And high upon a mountainside a Troll laughs.

Such are the exploits of the bombardier. Hurling not just a rock, but a avalanche, a decimating force of rocks destroying all who oppose him."+{SPECIAL_NOTES}+{SPECIAL_NOTES_REGENERATES}
    die_sound={SOUND_LIST:TROLL_DIE}
    [portrait]
        size=400
        side="left"
        mirror="false"
        image="portraits/trolls/transparent/troll-rocklobber.png"
    [/portrait]
    [portrait]
        size=400
        side="right"
        mirror="true"
        image="portraits/trolls/transparent/troll-rocklobber.png"
    [/portrait]
    [abilities]
        {ABILITY_REGENERATES}
    [/abilities]
    [resistance]
        blade=70
        pierce=70
    [/resistance]
    [attack]
        name=fist
        description=_"fist"
        icon=attacks/fist-troll.png
        type=impact
        range=melee
        damage=18
        number=2
    [/attack]
    [attack]
        name=sling
        description=_"sling"
	icon=attacks/boulder.png
        type=impact
        range=ranged
        damage=40
        number=1
        [specials]
    [dummy]
        id=shockwave
        name="shockwave"
        name_inactive="shockwave"
        description= _ "If this attack misses, it will still do 20% of the original damage due to the sheer power of the shockwave caused by the attack. Damage dealt this way won't be able kill though."
    [/dummy]
        [/specials]
    [/attack]
    {DEFENSE_ANIM "units/trolls/bombardier.png" "units/trolls/bombardier.png" {SOUND_LIST:TROLL_HIT} }
    [attack_anim]
        [filter_attack]
            name=sling
        [/filter_attack]
        start_time=-1000
        offset=0

        sling_stone_start_time=-800
        [if]
            hits=yes
            [sling_stone_frame]
                halo="projectiles/boulder.png:800"
                halo_x=24~0
                halo_y=0~-10,-10~-18,-18~-22,-22~-24,-24~-25,-25~-24,-24~-22,-22~-18,-18~-10,-10~-0
                offset=0.0~1.0
            [/sling_stone_frame]

            [frame]
                image="units/trolls/bombardier-ranged.png:200"
                sound=sling-big.ogg
            [/frame]
        [/if]
        [else]
            hits=no
            [sling_stone_frame]
                halo="projectiles/boulder.png:900"
                halo_x=24~0
                halo_y=0~-10,-10~-16,-16~-20,-20~-22,-22~-20,-20~-16,-16~-10,-10~0,0~-4,-4~0,0~-2,-2~0
                offset=0.0~1.5
            [/sling_stone_frame]

            [frame]
                image="units/trolls/bombardier-ranged.png:200"
                sound=sling-big-miss.ogg
            [/frame]
        [/else]
        [sound_frame]
           sound=rumble.ogg
        [/sound_frame]
        sound_start_time=-100
        [frame]
            duration=600
            image="units/trolls/bombardier-ranged.png"
        [/frame]

        [frame]
            duration=100
            image="units/trolls/bombardier.png"
        [/frame]
        [frame]
            duration=100
            image="units/trolls/bombardier.png"
        [/frame]
    [/attack_anim]
    [attack_anim]
        [filter_attack]
            name=fist
        [/filter_attack]
        start_time=-200
        [frame]
            duration=50
            image="units/trolls/bombardier.png"
        [/frame]
        [if]
            hits=yes
            [frame]
                duration=250
                image="units/trolls/bombardier.png"
                sound=fist.ogg
            [/frame]
        [/if]
        [else]
            hits=no
            [frame]
                duration=250
                image="units/trolls/bombardier.png"
                sound={SOUND_LIST:MISS}
            [/frame]
        [/else]
        [frame]
            duration=100
            image="units/trolls/bombardier.png"
        [/frame]
    [/attack_anim]
    [event]
        name=attacker misses
        first_time_only=no
        [filter_attack]
            special=shockwave
        [/filter_attack]
        [set_variable]
          name=weapon.damage
          multiply=0.2
        [/set_variable]
        [harm_unit]
            [filter]
                    x,y=$x2,$y2
            [/filter]
            [filter_second]
                x,y=$x1,$y1
            [/filter_second]
            amount=$weapon.damage
            alignment=$unit.alignment
            damage_type=$weapon.type
            experience=no
            kill=no
            fire_event=yes
	    animate=no
        [/harm_unit] 
    [/event]
    [event]
        name=defender misses
        first_time_only=no
        [filter_second_attack]
            special=shockwave
        [/filter_second_attack]
        [set_variable]
          name=second_weapon.damage
          multiply=0.2
        [/set_variable]
        [harm_unit]
            [filter]
                    x,y=$x1,$y1
            [/filter]
            [filter_second]
                x,y=$x2,$y2
            [/filter_second]
            amount=$second_weapon.damage
            alignment=$second_unit.alignment
            damage_type=$second_weapon.type
            experience=no
            kill=no
            fire_event=yes
	    animate=no
        [/harm_unit] 
    [/event]
[/unit_type]
