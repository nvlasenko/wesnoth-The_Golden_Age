		#define GHOSTMOVEFAKE_EVENT
    [event]
	    name=new turn
	    first_time_only=no
			{VARIABLE_OP ghost1spawn rand (0,0,0,1)}
			{VARIABLE_OP ghost2spawn rand (0,0,0,1)}
		[if]
		    [variable]
			    name=ghost1spawn
		            greater_than=0
			[/variable]
			[then]
        [scroll_to]
                                x,y=18,15
        [/scroll_to]
        [sound]
          name=wail-sml.wav
        [/sound]
        [move_unit_fake]
            type=Ghost
            x=17,18,19,20,21-22,23-24
            y=3-4,4-5,6,7,8
            side=3
        [/move_unit_fake]
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=ghost2spawn
		            greater_than=0
			[/variable]
			[then]
        [scroll_to]
                                x,y=7,16
        [/scroll_to]
        [sound]
          name=wail-sml.wav
        [/sound]
        [move_unit_fake]
            type=Ghost
            x=8,7,6-5,4-3,2-1
            y=18-17,17-16,15,14,13
            side=3
        [/move_unit_fake]
		    [/then]
		[/if]
        [scroll_to]
           side=$side_number
           canrecruit=yes
        [/scroll_to]
	[/event]
#enddef
#define GHOST_PORTAL NUMBER X Y
		[if]
		    [variable]
			    name=hardmode
		            greater_than=0
#		            equals=yes
			[/variable]
			[then]
#			{VARIABLE_OP ghostportal{NUMBER}type rand (Ghost,Ghost,Poltergeist,Poltergeist,Elvish Warrior Spirit,Elvish Warrior Spirit,Black Rider,Wraith,Shadow,Elvish Ancestor,Black Horseman,Spectre,Nightgaunt,Elvish Forefather,Black Slayer)}
			{VARIABLE_OP ghostportal{NUMBER}type rand (Spook,Spook,Ghost,Ghost,Ghost,Poltergeist,Poltergeist,Elvish Warrior Spirit,Elvish Warrior Spirit,Black Rider,Wraith,Shadow,Elvish Ancestor,Black Horseman,Spectre,Nightgaunt,Elvish Forefather,Black Slayer)}
		    [/then]
                    [else]
#			{VARIABLE_OP ghostportal{NUMBER}type rand (Spook,Spook,Ghost,Ghost,Ghost,Poltergeist,Poltergeist,Elvish Warrior Spirit,Elvish Warrior Spirit,Black Rider,Wraith,Shadow,Elvish Ancestor,Black Horseman,Spectre,Nightgaunt,Elvish Forefather,Black Slayer)}
			{VARIABLE_OP ghostportal{NUMBER}type rand (Spook,Spook,Spook,Spook,Ghost,Ghost,Ghost,Ghost,Ghost,Ghost,Poltergeist,Poltergeist,Poltergeist,Poltergeist,Elvish Warrior Spirit,Elvish Warrior Spirit,,Elvish Warrior Spirit,Elvish Warrior Spirit,Black Rider,Black Rider,Wraith,Wraith,Shadow,Shadow,Elvish Ancestor,Elvish Ancestor,Black Horseman,Black Horseman,Spectre,Nightgaunt,Elvish Forefather,Black Slayer)}
                    [/else]
		[/if]
		[if]
		    [variable]
			    name=hardmode
		            greater_than=0
#		            equals=yes
			[/variable]
			[then]
			{VARIABLE_OP ghostportal{NUMBER}exp rand (1,2,3,4,5,6)}
		    [/then]
                    [else]
			{VARIABLE_OP ghostportal{NUMBER}exp rand (1,2,3,4)}
                    [/else]
		[/if]
        [delay]
            time=100
        [/delay]
        [scroll_to]
                                x,y={X},{Y}
        [/scroll_to]
        [sound]
          name=magic-dark-big.ogg
        [/sound]
        [delay]
            time=20
        [/delay]
        [sound]
          name=magic-dark-big.ogg
        [/sound]
        [delay]
            time=20
        [/delay]
        [sound]
          name=magic-dark-big.ogg 
        [/sound]
        [unit]
            type=$ghostportal{NUMBER}type
            side=3
            x,y={X},{Y}
            random_traits=yes
            experience=$ghostportal{NUMBER}exp
            animate=yes
        [/unit]
        [delay]
            time=100
        [/delay]
#enddef
#define GHOST_PORTAL_LESSER NUMBER X Y
		[if]
		    [variable]
			    name=hardmode
		            greater_than=0
#		            equals=yes
			[/variable]
			[then]
#			{VARIABLE_OP ghostportal{NUMBER}type rand (Ghost,Ghost,Poltergeist,Poltergeist,Elvish Warrior Spirit,Elvish Warrior Spirit,Black Rider,Wraith,Shadow,Elvish Ancestor,Black Horseman,Spectre,Nightgaunt,Elvish Forefather,Black Slayer)}
			{VARIABLE_OP ghostportal{NUMBER}type rand (Spook,Spook,Spook,Spook,Ghost,Ghost,Ghost,Ghost,Ghost,Ghost,Poltergeist,Poltergeist,Poltergeist,Poltergeist,Elvish Warrior Spirit,Elvish Warrior Spirit,Elvish Warrior Spirit,Elvish Warrior Spirit,Black Rider,Black Rider,Wraith,Wraith,Shadow,Shadow,Elvish Ancestor,Elvish Ancestor,Black Horseman,Black Horseman,Spectre,Nightgaunt,Elvish Forefather,Black Slayer)}
		    [/then]
                    [else]
#			{VARIABLE_OP ghostportal{NUMBER}type rand (Spook,Spook,Ghost,Ghost,Ghost,Poltergeist,Poltergeist,Elvish Warrior Spirit,Elvish Warrior Spirit,Black Rider,Wraith,Shadow,Elvish Ancestor,Black Horseman,Spectre,Nightgaunt,Elvish Forefather,Black Slayer)}
			{VARIABLE_OP ghostportal{NUMBER}type rand (Spook,Spook,Ghost,Ghost,Ghost,Poltergeist,Poltergeist,Elvish Warrior Spirit,Elvish Warrior Spirit,Black Rider,Wraith,Shadow,Elvish Ancestor,Black Horseman)}
                    [/else]
		[/if]
		[if]
		    [variable]
			    name=hardmode
		            greater_than=0
#		            equals=yes
			[/variable]
			[then]
			{VARIABLE_OP ghostportal{NUMBER}exp rand (1,2,3,4,5,6)}
		    [/then]
                    [else]
			{VARIABLE_OP ghostportal{NUMBER}exp rand (1,2,3,4)}
                    [/else]
		[/if]
        [delay]
            time=100
        [/delay]
        [scroll_to]
                                x,y={X},{Y}
        [/scroll_to]
        [sound]
          name=magic-dark-big.ogg
        [/sound]
        [delay]
            time=20
        [/delay]
        [sound]
          name=magic-dark-big.ogg
        [/sound]
        [unit]
            type=$ghostportal{NUMBER}type
            side=3
            x,y={X},{Y}
            random_traits=yes
            experience=$ghostportal{NUMBER}exp
            animate=yes
        [/unit]
        [delay]
            time=100
        [/delay]
#enddef
#define GHOST_PORTAL_EVENT
    [event]
	    name=new turn
	    first_time_only=no
		[if]
                       [have_unit]
                            id=Boss1
                       [/have_unit]
                       [and]
                        [variable]
			    name=bossstage
		            greater_than=1
			[/variable]
                       [/and]
		    [then]
      {GHOST_PORTAL 1 9 9}
      {GHOST_PORTAL 2 13 7}
      {GHOST_PORTAL 3 11 12}
      {GHOST_PORTAL 4 15 10}
		    [/then]
		[/if]
	[/event]
#enddef
#define UNITDIE_EVENT
    [event]
        name=die
        first_time_only=no
        [filter]
           side=1,2
                [not]
                  type=Goblin Transport,Goblin Caravan,Wolf Rider,Goblin Knight,Direwolf Rider,Goblin Pillager,Gryphon Rider,Gryphon Master,Gryphon Lord,Rancher,Horseman,Knight,Lancer,Grand Knight,Paladin,Cavalryman,Dragoon,Horse Archer,Cavalier,Elvish Scout,Elvish Rider,Elvish Outrider,Elvish Bowrider,Elvish Horsebow,Brigand,Raider,Rogue Knight,Black Knight,Thief,Rogue,Assassin,Salamander,Black Salamander,Shadow Salamander,Green Salamander,Forest Salamander,Blue Salamander,Sea Salamander
                  [or]
                   race=elf,drake
                  [/or]
                [/not]
       [and]
        [not]
            [filter_wml]
                [status]
                    not_living="yes"
                [/status]
            [/filter_wml]
        [/not]
       [/and]
        [/filter]
        [store_unit]
            [filter]
                id=$unit.id
            [/filter]
            variable=ghost_store
            kill=yes
        [/store_unit]
		[if]
		    [variable]
			    name=hardmode
#		            equals=yes
		            greater_than=0
			[/variable]
			[then]
		    [set_variable]
			    name=ghost_store.level
		            add=1
			[/set_variable]
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=ghost_store.level
		            greater_than=0
			[/variable]
			[then]
		    [set_variable]
			    name=ghost_storetype2
		            value=Spook
			[/set_variable]
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=ghost_store.level
		            greater_than=1
			[/variable]
			[then]
		    [set_variable]
			    name=ghost_storetype2
		            value=Ghost
			[/set_variable]
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=ghost_store.level
		            greater_than=2
			[/variable]
			[then]
		    [set_variable]
			    name=ghost_storetype2
		            value=Wraith
			[/set_variable]
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=ghost_store.level
		            greater_than=3
			[/variable]
			[then]
		    [set_variable]
			    name=ghost_storetype2
		            value=Spectre
			[/set_variable]
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=ghost_store.level
		            greater_than=0
			[/variable]
			[then]
                     {GHOSTUNIT}
		    [/then]
		[/if]
    [/event]
    [event]
        name=die
        first_time_only=no
        [filter]
           side=1,2
           race=drake
       [and]
        [not]
            [filter_wml]
                [status]
                    not_living="yes"
                [/status]
            [/filter_wml]
        [/not]
       [/and]
        [/filter]
        [store_unit]
            [filter]
                id=$unit.id
            [/filter]
            variable=ghost_store
            kill=yes
        [/store_unit]
		[if]
		    [variable]
			    name=hardmode
#		            equals=yes
		            greater_than=0
			[/variable]
			[then]
		    [set_variable]
			    name=ghost_store.level
		            add=1
			[/set_variable]
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=ghost_store.level
		            greater_than=0
			[/variable]
			[then]
		    [set_variable]
			    name=ghost_storetype2
		            value=Fire Wisp
			[/set_variable]
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=ghost_store.level
		            greater_than=1
			[/variable]
			[then]
		    [set_variable]
			    name=ghost_storetype2
		            value=TGA Fire Guardian
			[/set_variable]
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=ghost_store.level
		            greater_than=2
			[/variable]
			[then]
		    [set_variable]
			    name=ghost_storetype2
		            value=Fire Warden
			[/set_variable]
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=ghost_store.level
		            greater_than=3
			[/variable]
			[then]
		    [set_variable]
			    name=ghost_storetype2
		            value=Fire Avatar
			[/set_variable]
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=ghost_store.level
		            greater_than=0
			[/variable]
			[then]
                     {GHOSTUNIT}
		    [/then]
		[/if]
    [/event]
    [event]
        name=die
        first_time_only=no
        [filter]
           side=1,2
           race=elf
       [and]
        [not]
            [filter_wml]
                [status]
                    not_living="yes"
                [/status]
            [/filter_wml]
        [/not]
       [/and]
        [/filter]
        [store_unit]
            [filter]
                id=$unit.id
            [/filter]
            variable=ghost_store
            kill=yes
        [/store_unit]
		[if]
		    [variable]
			    name=hardmode
#		            equals=yes
		            greater_than=0
			[/variable]
			[then]
		    [set_variable]
			    name=ghost_store.level
		            add=1
			[/set_variable]
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=ghost_store.level
		            greater_than=0
			[/variable]
			[then]
		    [set_variable]
			    name=ghost_storetype2
		            value=Spook
			[/set_variable]
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=ghost_store.level
		            greater_than=1
			[/variable]
			[then]
		    [set_variable]
			    name=ghost_storetype2
		            value=Elvish Warrior Spirit
			[/set_variable]
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=ghost_store.level
		            greater_than=2
			[/variable]
			[then]
		    [set_variable]
			    name=ghost_storetype2
		            value=Elvish Ancestor
			[/set_variable]
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=ghost_store.level
		            greater_than=3
			[/variable]
			[then]
		    [set_variable]
			    name=ghost_storetype2
		            value=Elvish Forefather
			[/set_variable]
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=ghost_store.level
		            greater_than=0
			[/variable]
			[then]
                     {GHOSTUNIT}
		    [/then]
		[/if]
    [/event]
    [event]
        name=die
        first_time_only=no
        [filter]
           side=1,2
           type=Wolf Rider,Goblin Knight,Direwolf Rider,Goblin Pillager,Gryphon Rider,Gryphon Master,Gryphon Lord,Rancher,Horseman,Knight,Lancer,Grand Knight,Paladin,Cavalryman,TGA Cavalryman,Dragoon,Horse Archer,Cavalier,Elvish Scout,TGA Elvish Scout,Elvish Rider,Elvish Outrider,Elvish Bowrider,Elvish Horsebow,Brigand,Raider,Rogue Knight,Black Knight
       [and]
        [not]
            [filter_wml]
                [status]
                    not_living="yes"
                [/status]
            [/filter_wml]
        [/not]
       [/and]
        [/filter]
        [store_unit]
            [filter]
                id=$unit.id
            [/filter]
            variable=ghost_store
            kill=yes
        [/store_unit]
		[if]
		    [variable]
			    name=hardmode
#		            equals=yes
		            greater_than=0
			[/variable]
			[then]
		    [set_variable]
			    name=ghost_store.level
		            add=1
			[/set_variable]
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=ghost_store.level
		            greater_than=0
			[/variable]
			[then]
		    [set_variable]
			    name=ghost_storetype2
		            value=Spook
			[/set_variable]
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=ghost_store.level
		            greater_than=1
			[/variable]
			[then]
		    [set_variable]
			    name=ghost_storetype2
		            value=Black Rider
			[/set_variable]
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=ghost_store.level
		            greater_than=2
			[/variable]
			[then]
		    [set_variable]
			    name=ghost_storetype2
		            value=Black Horseman
			[/set_variable]
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=ghost_store.level
		            greater_than=3
			[/variable]
			[then]
		    [set_variable]
			    name=ghost_storetype2
		            value=Black Slayer
			[/set_variable]
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=ghost_store.level
		            greater_than=0
			[/variable]
			[then]
                     {GHOSTUNIT}
		    [/then]
		[/if]
    [/event]
    [event]
        name=die
        first_time_only=no
        [filter]
           side=1,2
           type=Thief,Rogue,Assassin,Salamander,Black Salamander,Shadow Salamander,Green Salamander,Forest Salamander,Blue Salamander,Sea Salamander
       [and]
        [not]
            [filter_wml]
                [status]
                    not_living="yes"
                [/status]
            [/filter_wml]
        [/not]
       [/and]
        [/filter]
        [store_unit]
            [filter]
                id=$unit.id
            [/filter]
            variable=ghost_store
            kill=yes
        [/store_unit]
		[if]
		    [variable]
			    name=hardmode
#		            equals=yes
		            greater_than=0
			[/variable]
			[then]
		    [set_variable]
			    name=ghost_store.level
		            add=1
			[/set_variable]
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=ghost_store.level
		            greater_than=0
			[/variable]
			[then]
		    [set_variable]
			    name=ghost_storetype2
		            value=Spook
			[/set_variable]
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=ghost_store.level
		            greater_than=1
			[/variable]
			[then]
		    [set_variable]
			    name=ghost_storetype2
		            value=Poltergeist
			[/set_variable]
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=ghost_store.level
		            greater_than=2
			[/variable]
			[then]
		    [set_variable]
			    name=ghost_storetype2
		            value=Shadow
			[/set_variable]
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=ghost_store.level
		            greater_than=3
			[/variable]
			[then]
		    [set_variable]
			    name=ghost_storetype2
		            value=Nightgaunt
			[/set_variable]
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=ghost_store.level
		            greater_than=0
			[/variable]
			[then]
                     {GHOSTUNIT}
		    [/then]
		[/if]
    [/event]
#enddef
#define GHOSTUNIT
        [sound]
          name=wail.wav
        [/sound]
		    [set_variable]
			    name=ghost_store.experience
		            divide=2
			[/set_variable]
        [unit]
            side=3
            x=$ghost_store.x
            y=$ghost_store.y
            name=$ghost_store.name
            gender=$ghost_store.gender
            experience=$ghost_store.experience
            type=$ghost_storetype2
            moves=0
            facing=$ghost_store.facing
            attacks_left=0
            animate=no
        [/unit]
        [object]
          silent=yes
          duration=forever
         [filter]
           x,y=$x1,$y1
         [/filter]
        silent=yes
        [effect]
            apply_to=status
            remove=poisoned
        [/effect]
        [effect]
            apply_to=status
            remove=slowed
        [/effect]
    [/object]
        {CLEAR_VARIABLE ghost_store}
        {CLEAR_VARIABLE ghost_storetype2} 
#enddef
