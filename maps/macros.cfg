#textdomain wesnoth
#define IS_BOSS_TGA
    overlays=misc/boss-icon-tga.png
    random_traits=no
#enddef
#define IS_MINIBOSS_TGA
    overlays=misc/miniboss-icon-new.png
    random_traits=no
#enddef
#define BOSS_POPUP
    [print]
        text= _ "Enemy boss sighted!"
        red,green,blue=255,127,0
        size=32
    [/print]
#enddef
#define MINIBOSSES_POPUP
    [print]
        text= _ "Enemy minibosses sighted!"
        red,green,blue=0,127,255
        size=30
    [/print]
#enddef
#define TGA_PLACE_UNIT ID TYPE SIDE X Y 
        [unit]
            id={ID}
            type={TYPE}
            side={SIDE}
            x,y={X},{Y}
            random_traits=yes
        [/unit]
#enddef
#define TGA_PLACE_UNIT_NOID TYPE SIDE X Y 
        [unit]
            type={TYPE}
            side={SIDE}
            x,y={X},{Y}
            random_traits=yes
        [/unit]
#enddef
#define TGA_PLACE_UNIT_NOID_NIGHTSTALK TYPE SIDE X Y 
        [unit]
            type={TYPE}
            side={SIDE}
            x,y={X},{Y}
            random_traits=yes
        [/unit]
        [object]
          silent=yes
          duration=forever
         [filter]
           x={X}
           y={Y}
           type={TYPE}
         [/filter]
		[effect]
			apply_to=new_ability
			[abilities]
				{ABILITY_NIGHTSTALK}
			[/abilities]
		[/effect]
        [/object]
#enddef
#define TGA_PLACE_UNIT_NOID_NIGHTSTALK2 TYPE SIDE X Y 
        [unit]
            type={TYPE}
            side={SIDE}
            x,y={X},{Y}
            random_traits=yes
        [/unit]
        [object]
          silent=yes
          duration=forever
         [filter]
           x={X}
           y={Y}
           type={TYPE}
         [/filter]
		[effect]
			apply_to=new_ability
			[abilities]
				{ABILITY_NIGHTSTALK}
				{ABILITY_CONCEALMENT}
			[/abilities]
		[/effect]
        [/object]
#enddef
#define TGA_PLACE_UNIT_NOID_AMBUSH TYPE SIDE X Y 
        [unit]
            type={TYPE}
            side={SIDE}
            x,y={X},{Y}
            random_traits=yes
        [/unit]
        [object]
          silent=yes
          duration=forever
         [filter]
           x={X}
           y={Y}
           type={TYPE}
         [/filter]
		[effect]
			apply_to=new_ability
			[abilities]
				{ABILITY_AMBUSH}
			[/abilities]
		[/effect]
        [/object]
#enddef
#define TGA_PLACE_UNIT_NOID_CHAOTIC TYPE SIDE X Y 
        [unit]
            type={TYPE}
            side={SIDE}
            x,y={X},{Y}
            random_traits=yes
            animate=yes
        [/unit]
        [modify_unit]
         [filter]
           x={X}
           y={Y}
           type={TYPE}
         [/filter]
         alignment=chaotic
        [/modify_unit]
#enddef
#define TGA_PLACE_UNIT_NOID_CHAOTIC_SLOW TYPE SIDE X Y 
        [unit]
            type={TYPE}
            side={SIDE}
            x,y={X},{Y}
            random_traits=yes
        [/unit]
        [modify_unit]
         [filter]
           x={X}
           y={Y}
           type={TYPE}
         [/filter]
         alignment=chaotic
        [/modify_unit]
        [object]
          silent=yes
          duration=forever
         [filter]
           x={X}
           y={Y}
           type={TYPE}
         [/filter]
        [effect]
            apply_to=hitpoints
            increase=100
            increase_total=100
        [/effect]
        [effect]
            apply_to=attack
            range=melee
#            increase_damage=4
#            increase_attacks={_MELEE_STRIKES_INCREASE}
        [/effect]
        [effect]
            apply_to=movement
            increase=-3
        [/effect]
        [effect]
            apply_to=max_experience
            increase=100
        [/effect]
        [/object]
#enddef
#define ATTACK_EVENTS
    [event]
        name=attack
        first_time_only=yes
        [filter]
            type=Fallen Sprite
            side=3
        [/filter]
                [message]
                    speaker=unit
                    message= _ "You shall pay for trespassing, mortal!"
                [/message]
                [message]
                    speaker=second_unit
                    message= _ "ummm, 5 gold, 10 gold?"
                [/message]
                [message]
                    speaker=unit
                    message= _ "That's not what i meant!"
                [/message]
    [/event]
    [event]
        name=attack
        first_time_only=yes
        [filter]
            type=Fallen Faerie
            side=3
        [/filter]
                [message]
                    speaker=unit
                    message= _ "<i>I almost feel bad for you</i>... just kidding! more like al-least!"
                [/message]
                [message]
                    speaker=second_unit
                    message= _ "ummm, thanks, maybe?"
                [/message]
    [/event]
    [event]
        name=attack
        first_time_only=yes
        [filter]
            type=Spook
            side=3
        [/filter]
                [message]
                    speaker=unit
                    message= _ "<i>...</i>"
                [/message]
                [message]
                    speaker=second_unit
                    message= _ "..."
                [/message]
    [/event]
    [event]
        name=attack
        first_time_only=yes
        [filter]
            type=Ghost
            side=3
        [/filter]
                [message]
                    speaker=unit
                    message= _ "<i>Peek-a-boo!...</i>"
                [/message]
                [message]
                    speaker=second_unit
                    message= _ "Aaah!"
                [/message]
    [/event]
    [event]
        name=attack
        first_time_only=yes
        [filter]
            type=Wraith
            side=3
        [/filter]
                [message]
                    speaker=unit
                    message= _ "<i>you shall not pass...</i>"
                [/message]
                [message]
                    speaker=second_unit
                    message= _ "How about i shall?"
                [/message]
    [/event]
    [event]
        name=attack
        first_time_only=yes
        [filter]
            type=Spectre
            side=3
        [/filter]
                [message]
                    speaker=unit
                    message= _ "<i>i used to be a mortal like you, but then i got an arrow in the knee...</i>, aaand that's how ended up at this stupid job..."
                [/message]
                [message]
                    speaker=second_unit
                    message= _ "Want me to fire you from it?"
                [/message]
                [message]
                    speaker=unit
                    message= _ "Of course i do! by the way, i apologise beforehand if i attack you, i don't have much free will besides talking."
                [/message]
    [/event]
    [event]
        name=attack
        first_time_only=yes
        [filter]
            type=Poltergeist
            side=3
        [/filter]
                [message]
                    speaker=unit
                    message= _ "<i>*this ghost draws it's weapons*</i>"
                [/message]
                [message]
                    speaker=second_unit
                    message= _ "Uh-oh!"
                [/message]
    [/event]
    [event]
        name=attack
        first_time_only=yes
        [filter]
            type=Elvish Warrior Spirit
            side=3
        [/filter]
                [message]
                    speaker=unit
                    message= _ "<i>the cold, the cold, it burns...</i>"
                [/message]
                [message]
                    speaker=second_unit
                    message= _ "ummm... what is that supposed to mean?"
                [/message]
    [/event]
    [event]
        name=attack
        first_time_only=yes
        [filter]
            type=Gryphon,Young Gryphon
            side=3
        [/filter]
                [message]
                    speaker=unit
                    message= _ "Kreeeeee!"
                [/message]
                [message]
                    speaker=second_unit
                    message= _ "Looks like we are going to have fried gryphons for dinner. or we are going to be their dinner, who knows."
                [/message]
    [/event]
    [event]
        name=attack
        first_time_only=yes
        [filter]
            type=Walking Corpse,Soulless
            side=3
        [/filter]
                [message]
                    speaker=unit
                    message= _ "Braaaains!"
                [/message]
                [message]
                    speaker=second_unit
                    message= _ "Sorry, premium access only."
                [/message]
    [/event]
    [event]
        name=attack
        first_time_only=yes
        [filter]
            type=Skeleton,Skeleton Archer,Skeleton Recruit,Revenant
            side=3
        [/filter]
                [message]
                    speaker=unit
                    message= _ "I, the great Papyr... oh crap!, sorry for copyrighting."
                [/message]
                [message]
                    speaker=second_unit
                    message= _ "Ummmm... what?"
                [/message]
                [message]
                    speaker=unit
                    message= _ "Eh, nevermind. How about going back to fighting, i guess?"
                [/message]
                [message]
                    speaker=second_unit
                    message= _ "Yeah, that sounds reasonable"
                [/message]
    [/event]
    [event]
        name=attack
        first_time_only=yes
        [filter]
            type=Mudcrawler,Giant Mudcrawler
            side=3
        [/filter]
                [message]
                    speaker=unit
                    message= _ "Blurp, Blurp!"
                [/message]
                [message]
                    speaker=second_unit
                    message= _ "Blurp blurp?"
                [/message]
                [message]
                    speaker=unit
                    message= _ "Blorp, Blorp?"
                [/message]
                [message]
                    speaker=second_unit
                    message= _ "ok, this is getting weird."
                [/message]
    [/event]
    [event]
        name=attack
        first_time_only=yes
        [filter]
            type=Dark Cultist
            side=3
        [/filter]
                [message]
                    speaker=unit
                    message= _ "For the darkness!"
                [/message]
                [message]
                    speaker=second_unit
                    message= _ "<i>Jeez, those fanatics give me creeps...</i>"
                [/message]
    [/event]
    [event]
        name=attack
        first_time_only=yes
        [filter]
            type=Dark Cult Enforcer
            side=3
        [/filter]
                [message]
                    speaker=unit
                    message= _ "Join the dark side!"
                [/message]
                [message]
                    speaker=second_unit
                    message= _ "Didn't i hear this phrase from somewhere?"
                [/message]
                [message]
                    speaker=unit
                    message= _ "Copyright issues again?! Oh crap! anyways, i got some fighting to do, so chit-chat aside!"
                [/message]
    [/event]
    [event]
        name=last breath
        first_time_only=yes
        [filter]
            type=Dark Cult Enforcer
            side=3
        [/filter]
                        [filter_second_attack]
                          [not]
                                 type=arcane
                          [/not]
                        [/filter_second_attack]
                [message]
                    speaker=unit
                    message= _ "Ha ha, you weaklings can't kill me, Her Majesty made me immortal!"
                [/message]
                [message]
                    speaker=second_unit
                    message= _ "<i>Hrmph! he's got to have some kind of a weakness...</i>"
                [/message]
    [/event]
    [event]
        name=last breath
        first_time_only=yes
        [filter]
            type=Dark Cult Enforcer
            side=3
        [/filter]
                        [filter_second_attack]
                                 type=arcane
                        [/filter_second_attack]
                [message]
                    speaker=unit
                    message= _ "What?! How's that possible?! damn, i should have bought an arcane attack insurance before this, argh!..."
                [/message]
                [message]
                    speaker=second_unit
                    message= _ "Serves him right..."
                [/message]
    [/event]
    [event]
        name=attack
        first_time_only=yes
        [filter]
            type=Wose,Elder Wose,Wose Shaman,Ancient Wose
            side=3
        [/filter]
                [message]
                    speaker=unit
                    message= _ "You will pay for disturbing my sleep!"
                [/message]
                [message]
                    speaker=second_unit
                    message= _ "I though you were just a tree..."
                [/message]
    [/event]
    [event]
        name=attack
        first_time_only=yes
        [filter]
            type=Archaic Wose
            side=3
        [/filter]
                [message]
                    speaker=unit
                    message= _ "<i>Must...</i> <b>DESTROY!!!</b>"
                [/message]
    [/event]
    [event]
        name=attack
        first_time_only=yes
        [filter]
            id=Boss1
        [/filter]
                [message]
                    speaker=unit
                    message= _ "<i>you don't know what you are messing with!</i>"
                [/message]
                [message]
                    speaker=second_unit
                    message= _ "ummm, a crazy forest faerie, perhaps?"
                [/message]
    [/event]
    [event]
        name=attack
        first_time_only=yes
        [filter_second]
            type=Archaic Wose
            side=3
        [/filter_second]
                [message]
                    speaker=Boss1
                    message= _ "<i>What do you think you are doing?</i>"
                [/message]
                [message]
                    speaker=unit
                    message= _ "Chopping a tree, perphaps?"
                [/message]
        [harm_unit]
            [filter]
               id=$unit.id
            [/filter]
            amount=10
            damage_type=arcane
            fire_event=yes
	    animate=yes
        [/harm_unit] 
    [/event]
    [event]
        name=die
        first_time_only=yes
        [filter_second]
           role=faerie
        [/filter_second]
                [message]
                    speaker=second_unit
                    message= _ "So, remember the body count? my score already getting near yours."
                [/message]
                [message]
                    speaker=Urithia
                    message= _ "Pah, stop bragging, my memory isn't as useless, don't you remember our previous 78 kill gap? all you did is make it 77, pathetic, isn't it?"
                [/message]
                [message]
                    speaker=second_unit
                    message= _ "<i>Hrmph!</i>"
                [/message]
    [/event]
    [event]
        name=last breath
        first_time_only=yes
        [filter]
           role=faerie
        [/filter]
                [message]
                    speaker=second_unit
                    message= _ "Got you!"
                [/message]
                [message]
                    speaker=unit
                    message= _ "Pah, not so fast..."
                [/message]
        [set_variables]
           name=wardcharm
           [value]
              x,y=$unit.x,$unit.y
           [/value]
#           [value]
#              picked_up=no
#           [/value]
#           [value]
#           [/value]
        [/set_variables]
                            [item]
                                x,y=$wardcharm.x,$wardcharm.y
                                image="items/charm.png"
                            [/item]
        [move_unit]
            role=faerie
            to_x=24
            to_y=3
        [/move_unit]
                [message]
                    speaker=unit
                    message= _ "<i>Phew, that was close. Well, i did lose my precious charm and the gold i had, but hey, at least i survived that, filthy apes...</i>"
                [/message]
        [kill]
            role=faerie
            animate=no
            fire_event=no
        [/kill]
  [sound]
         name=gold.ogg
  [/sound]
        [gold]
            side=1
            amount=25
        [/gold]
        [gold]
            side=2
            amount=25
        [/gold]
                [message]
                    speaker=second_unit
                    message= _ "Oh, look at that charm she dropped while running away! Commander, do you know what it is?"
                [/message]
                [message]
                    side=1
                    canrecruit=yes
                    message= _ "I think i seen one of these before. This kind charm can make their wearer more resilient, and better protected against magic."
                [/message]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
           x,y=$wardcharm.x,$wardcharm.y
        [/filter]
    [if]
      [variable]
         name=charm_pickup
         not_equals=yes
      [/variable]
      [then]
        [object]
            name= _ "Warding Charm"
            image=items/charm.png
            duration=forever
            description= _ "This charm grants the wearer +12 hp, +20% resistance to arcane, and +10% resistance to fire/cold"
#Warding Charm's effects:
        [effect]
            apply_to=hitpoints
            increase=12
            increase_total=12
        [/effect]
        [effect]
         apply_to=resistance
         replace=false
         [resistance]
         arcane=-20
         fire=-10
         cold=-10
         [/resistance]
        [/effect]
        [/object]
                                    [unit_overlay]
                                        x,y=$wardcharm.x|,$wardcharm.y|
                                        image=misc/charm_overlay.png
                                    [/unit_overlay]
        [set_variable]
           name=charm_pickup
           value=yes
        [/set_variable]
                            [remove_item]
                                x,y=$wardcharm.x|,$wardcharm.y|
                                image="items/charm.png"
                            [/remove_item]
                [message]
                    speaker=unit
                    message="Nice! it's good to have something to protect me."
                [/message]
      [/then]
    [/if]
    [/event]
    [event]
        name=attack
        first_time_only=yes
        [filter]
            type=Elvish Forefather
            side=3
        [/filter]
                [message]
                    speaker=unit
                    message= _ "<i>Do you know who i am?</i>"
                [/message]
                [message]
                    speaker=second_unit
                    message= _ "Ummmm... i don't?"
                [/message]
                [message]
                    speaker=unit
                    message= _ "<i><b>Argh! you mortals forget history as fast as you are breeding! oh well, i'll show you the past, you little vermin!</b></i>"
                [/message]
    [/event]

    [event]
        name=last breach
        first_time_only=yes
        [filter]
            id=apebones
        [/filter]
                [message]
                    speaker=unit
                    message= _ "Now noone will call me 'Sir Ape Bones', Yay!!!"
                [/message]
    [/event]
    [event]
        name=die
        first_time_only=no
        [filter]
            type=Archaic Wose
            side=3
        [/filter]
#        [terrain]
#            x,y=$unit.x,$unit.y
#            terrain=Gll
#        [/terrain]
#        [harm_unit]
#            [filter]
#               id=Boss1
#            [/filter]
#            amount=20
#            unhealable=yes
#            slows=yes
#            damage_type=$weapon.type
#            fire_event=yes
#	    animate=yes
#        [/harm_unit] 
	    [set_variable]
		    name=wosekilled
		    add=1
	    [/set_variable]
		[if]
		        [variable]
			    name=wosekilled
		            greater_than=5
			[/variable]
			[then]
        {WHITE_SCREEN}
        [sound]
          name=lightning.ogg
        [/sound]
        [delay]
            time=20
        [/delay]
        [sound]
          name=lightning.ogg
        [/sound]
        [delay]
            time=20
        [/delay]
        [sound]
          name=lightning.ogg
        [/sound]
        [delay]
            time=20
        [/delay]
        [sound]
          name=lightning.ogg
        [/sound]
        [delay]
            time=20
        [/delay]
        [sound]
          name=lightning.ogg
        [/sound]
        [delay]
            time=20
        [/delay]
        [sound]
          name=lightning.ogg
        [/sound]
        [delay]
            time=20
        [/delay]
        [sound]
          name=lightning.ogg
        [/sound]
        [delay]
            time=200
        [/delay]
        {RESET_SCREEN}
        {REPLACE_SCENARIO_MUSIC "silence.ogg"}
        [delay]
            time=1000
        [/delay]
                [message]
                    speaker=Boss1
                    message= _ "<i>I think i am out of woses...</i>"
                [/message]
        [delay]
            time=1000
        [/delay]
#                [message]
#                    speaker=Boss1
#                    message= _ "<i><b>THAT'S IT YOU LITTLE PIECE OF CRAP!!!, COME HERE, YOU BASTARD!!!</b></i>"
#                [/message]
#                [message]
#                    speaker=Boss1
#                    message= _ "You are testing my patience... <b>AND I SHALL MAKE SURE YOU'LL REGRET THAT!!!</b>"
#                [/message]
                [message]
                    speaker=Boss1
                    message= _ "<i>I guess i'll have to resort to using my backup plan...</i>"
                [/message]
        {REPLACE_SCENARIO_MUSIC "data/add-ons/TGA_Map_Music/music/one_thousand_suns.ogg"}
        [object]
          silent=yes
          duration=forever
         [filter]
           id=Boss1
         [/filter]
        silent=yes
#        [effect]
#            apply_to=hitpoints
#            increase=260
#            increase_total=260
#        [/effect]
        [effect]
            apply_to=max_experience
            increase=450
        [/effect]
        [effect]
            apply_to=movement
            increase=3
        [/effect]
    [/object]
    [teleport]
      [filter]
       id=Boss1
      [/filter]
       x,y=12,9
       animate=yes
    [/teleport]
        [modify_unit]
         [filter]
            id=Boss1
         [/filter]
            profile="portraits/transparent/heart_of_the_forest-mad-eyes.png"        
         [/modify_unit]
#she meant 'Oh warriors of the past! come! aid me in slaying these intruders!!!'
                        {FADE_TO_BLACK}
        [sound]
          name=lich-lord-hit.ogg
        [/sound]
        [sound]
          name=magic-dark-big.ogg
        [/sound]
        [sound]
          name=wail-long.wav
        [/sound]
                [message]
                    speaker=Boss1
                    message= _ "<span color='red' size='xx-large' weight='heavy'><i><b>Ghoh bryvurhrurrz hvu dryg muuzr! anrohbrmyzg! abgnaaz urgz muz zerder drazgruuzdryrz zerghgruuz!!!</b></i></span>"
                [/message]
                        {FADE_IN}
        {QUAKE (rumble.ogg)}
                            [delay]
                                time=200
                            [/delay]
        {QUAKE (rumble.ogg)}
                            [delay]
                                time=200
                            [/delay]
        {QUAKE (rumble.ogg)}
                            [delay]
                                time=200
                            [/delay]
        {QUAKE (rumble.ogg)}
                            [delay]
                                time=200
                            [/delay]
        {QUAKE (rumble.ogg)}
                            [delay]
                                time=200
                            [/delay]
        {QUAKE (rumble.ogg)}
                            [delay]
                                time=200
                            [/delay]
        {QUAKE (rumble.ogg)}
                            [delay]
                                time=200
                            [/delay]
        {QUAKE (rumble.ogg)}
                            [delay]
                                time=200
                            [/delay]
        {QUAKE (rumble.ogg)}
                            [delay]
                                time=200
                            [/delay]
        {QUAKE (rumble.ogg)}
        [terrain]
            x=9,13,11,15
            y=9,7,12,10
            terrain=Qxua
        [/terrain]
                            [item]
                                x=9,13,11,15
                                y=,9,7,12,10
                                halo="halo/darkness-beam-1.png"
                            [/item]
                            [delay]
                                time=100
                            [/delay]
                            [item]
                                x=9,13,11,15
                                y=,9,7,12,10
                                halo="halo/darkness-beam-2.png"
                            [/item]
                            [delay]
                                time=100
                            [/delay]
                            [item]
                                x=9,13,11,15
                                y=,9,7,12,10
                                halo="halo/darkness-beam-3.png"
                            [/item]
                            [delay]
                                time=100
                            [/delay]
                            [item]
                                x=9,13,11,15
                                y=,9,7,12,10
                                halo="halo/darkness-beam-4.png"
                            [/item]
        [sound]
          name=magic-dark-big.ogg
        [/sound]
        [sound]
          name=wail-long.wav
        [/sound]
        [sound]
          name=magic-dark-big.ogg
        [/sound]
        [sound]
          name=wail-long.wav
        [/sound]
        [sound]
          name=magic-dark-big.ogg
        [/sound]
        [sound]
          name=wail-long.wav
        [/sound]
        [sound]
          name=magic-dark-big.ogg
        [/sound]
        [sound]
          name=wail-long.wav
        [/sound]
        [sound]
          name=magic-dark-big.ogg
        [/sound]
        [sound]
          name=wail-long.wav
        [/sound]
        [sound]
          name=magic-dark-big.ogg
        [/sound]
        [sound]
          name=wail-long.wav
        [/sound]
        [sound]
          name=magic-dark-big.ogg
        [/sound]
        [sound]
          name=wail-long.wav
        [/sound]
        [sound]
          name=magic-dark-big.ogg
        [/sound]
        [sound]
          name=wail-long.wav
        [/sound]
                            [delay]
                                time=100
                            [/delay]
                            [item]
                                x=9,13,11,15
                                y=,9,7,12,10
                                halo="halo/darkness-beam-5.png"
                            [/item]
                            [delay]
                                time=100
                            [/delay]
                            [item]
                                x=9,13,11,15
                                y=,9,7,12,10
                                halo="halo/darkness-beam-6.png"
                            [/item]
                            [delay]
                                time=100
                            [/delay]
                            [item]
                                x=9,13,11,15
                                y=,9,7,12,10
                                halo="halo/darkness-beam-7.png"
                            [/item]
                            [delay]
                                time=100
                            [/delay]
                            [remove_item]
                                x=9,13,11,15
                                y=9,7,12,10
                            [/remove_item]
                            [item]
                                x=9,13,11,15
                                y=9,7,12,10
                                image=halo/portal-halo.png#:100,halo/portal-halo.png~SIZE(76,76):100,halo/portal-halo.png~SIZE(80,80):100,halo/portal-halo.png~SIZE(84,84):100,halo/portal-halo.png~SIZE(88,88):100,halo/portal-halo.png~SIZE(84,84):100,halo/portal-halo.png~SIZE(80.80):100,halo/portal-halo.png~SIZE(76,76):100
                            [/item]
        [sound_source]
            id=portal1
            sounds=wail-sml.wav,wail.wav
            delay=4000
            chance=90
            check_fogged=no
            check_shrouded=no
            x,y=9,9
            full_range=2
            fade_range=4
            loop=0
        [/sound_source]
        [sound_source]
            id=portal2
            sounds=wail-sml.wav,wail.wav
            delay=4000
            chance=90
            check_fogged=no
            check_shrouded=no
            x,y=13,7
            full_range=2
            fade_range=3
            loop=0
        [/sound_source]
        [sound_source]
            id=portal3
            sounds=wail-sml.wav,wail.wav
            delay=4000
            chance=90
            check_fogged=no
            check_shrouded=no
            x,y=11,12
            full_range=2
            fade_range=3
            loop=0
        [/sound_source]
        [sound_source]
            id=portal4
            sounds=wail-sml.wav,wail.wav
            delay=4000
            chance=90
            check_fogged=no
            check_shrouded=no
            x,y=15,10
            full_range=2
            fade_range=3
            loop=0
        [/sound_source]
      {GHOST_PORTAL 1 9 9}
      {GHOST_PORTAL 2 13 7}
      {GHOST_PORTAL 3 11 12}
      {GHOST_PORTAL 4 15 10}
	    [set_variable]
		    name=bossstage
		    add=1
	    [/set_variable]
                [message]
                    x,y=9,9
                    side=3
                    message= _ "<i>The darkness... it's coming...</i>"
                [/message]
                [message]
                    x,y=13,7
                    side=3
                    message= _ "<i>Ah yes, i feel it too...</i>"
                [/message]
                [message]
                    x,y=11,12
                    side=3
                    message= _ "<i>This is going to be sweet...</i>"
                [/message]
                [message]
                    x,y=15,10
                    side=3
                    message= _ "<i>More souls to bring into the Land of the Dead...</i>"
                [/message]
                [message]
                    side=2
                    canrecruit=yes
                    message= _ "What in the world is that supposed to be?"
                [/message]
                [message]
                    speaker=Urithia
                    message= _ "<i>It is your demise.</i>"
                [/message]
                [message]
                    side=1
                    canrecruit=yes
                    message= _ "We shall see..."
                [/message]
        [gold]
            side=1
            amount=50
        [/gold]
        [gold]
            side=2
            amount=50
        [/gold]
		        [/then]
			[else]
			[/else]
		[/if]
    [/event]
#enddef
#define BOSS1_TP SIDE X Y
    [event]
	    name=attack
		first_time_only=no
		[filter]
		   side={SIDE}
		[/filter]
		[filter_second]
		    id=Boss1
		[/filter_second]
		[if]
		    [variable]
#			    name=wosekilled
			    name=bossstage
		            less_than=2
			[/variable]
                        [or]
		    [variable]
			    name=tpshield
		            greater_than=0
			[/variable]
                        [/or]
			[then]
			    [message]
		            speaker=Boss1
		            message= _ "<i>Pffff, do you really think you can even hurt me?</i>"
	        	[/message]
		[store_unit]
		    [filter]
			    x=$x1
				y=$y1
			[/filter]
			kill=yes
			variable=teleported
		[/store_unit]
		[scroll_to]
		x={X}
		y={Y}
		[/scroll_to]
        {WHITE_SCREEN}
        [sound]
          name=lightning.ogg
        [/sound]
        [delay]
            time=100
        [/delay]
        {RESET_SCREEN}
		[unstore_unit]
		    variable=teleported
			find_vacant=yes
			x={X}
			y={Y}
		[/unstore_unit]
		        [message]
		            speaker=unit
			        message= _ "Whoah, what was that?"
		        [/message]
		[if]
		    [variable]
			    name=bossstage
		            greater_than=1
			[/variable]
			[then]
	    [set_variable]
		    name=tpshield
		    sub=1
	    [/set_variable]
		[if]
		    [variable]
			    name=tpshield
		            greater_than=1
			[/variable]
			[then]
    [print]
        text= _ "$tpshield| teleport shields remaining!"
        red,green,blue=255,127,0
        size=25
        duration=30
    [/print]
			[/then]
			[else]
		    [variable]
			    name=tpshield
		            equals=1
			[/variable]
    [print]
        text= _ "1 teleport shield remaining!"
        red,green,blue=255,127,0
        size=25
        duration=30
    [/print]
			[/else]
			[else]
		    [variable]
			    name=tpshield
		            less_than=1
			[/variable]
    [print]
        text= _ "no shields remaining!"
        red,green,blue=255,127,0
        size=25
        duration=30
    [/print]
			[/else]
		[/if]
			[/then]
		[/if]
                        [/then]
			[else]
			[/else]
		[/if]
		[set_variable]
		    name=attacked
		    value=yes
	    [/set_variable]
	[/event]
#enddef
#define RAND_LIGHTNING NUMBER
#no x 1-6 / 19-24  or y 1-5 / 16-20 to make sure the lightning won't hit the camp or hexes next to it :)
			{VARIABLE_OP lightning{NUMBER}x rand (7,8,9,10,11,12,13,14,15,16,17,18,19)}
			{VARIABLE_OP lightning{NUMBER}y rand (5,6,7,8,9,10,11,12,13,14,15,16)}
		[if]
		    [variable]
			    name=hardmode
		            #		            equals=yes
		            greater_than=0
			[/variable]
			[then]
			{VARIABLE_OP lightning{NUMBER}damage rand (15,20,25,30,35)}
		    [/then]
                    [else]
			{VARIABLE_OP lightning{NUMBER}damage rand (10,15,20,25)}
                    [/else]
		[/if]
			{VARIABLE_OP lightning{NUMBER}type rand (1,2,3)}
                            # impactanimation
        [scroll_to]
                                x,y=$lightning{NUMBER}x,$lightning{NUMBER}y
        [/scroll_to]
        [sound]
          name=lightning.ogg
        [/sound]
				{VARIABLE temp_y $lightning{NUMBER}y}
				{VARIABLE_OP temp_y add -2}
                            [item]
                                x,y=$lightning{NUMBER}x,$lightning{NUMBER}y
                                halo="halo/lightning-bolt-$lightning{NUMBER}type|-1.png"
                            [/item]
                            [delay]
                                time=100
                            [/delay]
                            [item]
                                x,y=$lightning{NUMBER}x,$lightning{NUMBER}y
                                halo="halo/lightning-bolt-$lightning{NUMBER}type|-2.png"
#                                halo_y=-125
                            [/item]
                            [delay]
                                time=100
                            [/delay]
                            [item]
                                x,y=$lightning{NUMBER}x,$lightning{NUMBER}y
                                halo="halo/lightning-bolt-$lightning{NUMBER}type|-3.png"
                            [/item]
                            [delay]
                                time=100
                            [/delay]
                            [item]
                                x,y=$lightning{NUMBER}x,$lightning{NUMBER}y
                                halo="halo/lightning-bolt-$lightning{NUMBER}type|-4.png"
                            [/item]
                            [delay]
                                time=100
                            [/delay]
                            [remove_item]
                                x,y=$lightning{NUMBER}x,$lightning{NUMBER}y
                            [/remove_item]
	    [set_variable]
		    name=lightning{NUMBER}y
		    add=2
	    [/set_variable]
		[if]
                       [have_unit]
                            side=1,2
                            x,y=$lightning{NUMBER}x,$lightning{NUMBER}y                             
                       [/have_unit]
			[then]
        [harm_unit]
            [filter]
#               side=1,2
                                x,y=$lightning{NUMBER}x,$lightning{NUMBER}y
            [/filter]
            amount=$lightning{NUMBER}damage
            damage_type=fire
            fire_event=yes
	    animate=yes
        [/harm_unit] 
        [modify_unit]
         [filter]
                                x,y=$lightning{NUMBER}x,$lightning{NUMBER}y
         [/filter]
            [status]
                slowed=yes
            [/status]
        [/modify_unit]
#i'll need to make the effext last during 'every' side's turn
		[store_unit]
			[filter]
                            side=1,2
                            x,y=$lightning{NUMBER}x,$lightning{NUMBER}y 
                         [not]
                          canrecruit=yes
                         [/not]
			[/filter]
			variable=stunnedtemp
		[/store_unit]
#                {VARIABLE stunnedtemp.moves 0}
#                {VARIABLE stunnedtemp.attacks_left 0}
		[unstore_unit]
			variable=stunnedtemp
			find_vacant=no
			text="slowed"
		        {COLOR_HARM}
		[/unstore_unit]
		    [/then]
		[/if]
		[if]
                       [have_unit]
                            side=3
                            x,y=$lightning{NUMBER}x,$lightning{NUMBER}y                          
                             [or]
                            side=1,2
                            canrecruit=yes
                            x,y=$lightning{NUMBER}x,$lightning{NUMBER}y 
                             [/or]
                       [/have_unit]
			[then]
		[store_unit]
			[filter]
                            side=3
                            x,y=$lightning{NUMBER}x,$lightning{NUMBER}y 
			[/filter]
			variable=enemytemp
		[/store_unit]
		[unstore_unit]
			variable=enemytemp
			find_vacant=no
			text="blocked"
		        {COLOR_HEAL}
		[/unstore_unit]
		    [/then]
		[/if]
                {CLEAR_VARIABLE lightning{NUMBER}x}
                {CLEAR_VARIABLE lightning{NUMBER}y}
                {CLEAR_VARIABLE lightning{NUMBER}damage}
                {CLEAR_VARIABLE lightning{NUMBER}type}
#enddef
#define RAND_LIGHTNING_EVENT
    [event]
	    name=new turn
	    first_time_only=no
		[if]
		    [variable]
			    name=thundersound
		            equals=yes
			[/variable]
			[then]
			{VARIABLE_OP soundvariant rand (-far,-far,-near)}
        [sound]
          name=thunder1$soundvariant|.ogg
        [/sound]
        [delay]
            time=2250
        [/delay]
		    [/then]
		[/if]
			{VARIABLE_OP thirdlightning rand (0,0,1)}
                         {RAND_LIGHTNING 1}
                         {RAND_LIGHTNING 2}
		[if]
		    [variable]
			    name=thirdlightning
		            greater_than=0
			[/variable]
			[then]
                         {RAND_LIGHTNING 3}
		    [/then]
		[/if]
		[if]
                       [have_unit]
                            id=Boss1
                       [/have_unit]
			[then]
                         {RAND_LIGHTNING 4}
                         {RAND_LIGHTNING 5}
                         {RAND_LIGHTNING 6}
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=bossstage
		            greater_than=1
			[/variable]
			[then]
                         {RAND_LIGHTNING 7}
                         {RAND_LIGHTNING 8}
                         {RAND_LIGHTNING 9}
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=hardmode
#		            #		            equals=yes
		            greater_than=0
			[/variable]
			[then]
                         {RAND_LIGHTNING 10}
		    [/then]
		[/if]
        [scroll_to]
           side=$side_number
           canrecruit=yes
        [/scroll_to]
	[/event]
#enddef
#define WHITE_SCREEN
    [color_adjust]
        red,green,blue=500,500,500
    [/color_adjust]
#enddef

#define BLACK_SCREEN
    [color_adjust]
        red,green,blue=-500,-500,-500
    [/color_adjust]
#enddef

#define RESET_SCREEN
    [color_adjust]
        red,green,blue=0,0,0
    [/color_adjust]
#enddef

#define BOSS1_LASTBREATH_EVENT
    [event]
        name=last breath
        first_time_only=no
        [filter]
            id=Boss1
        [/filter]
        [filter]
                        [filter_second_attack]
                                 type=arcane
                        [/filter_second_attack]
                        [or]
                          id=Boss1
                          hitpoints=full
                        [/or]
        [/filter]
        [modify_unit]
         [filter]
           id=Boss1
         [/filter]
          name="Heart of the Forest"
        [/modify_unit]
        [delay]
            time=250
        [/delay]
        {WHITE_SCREEN}
        [sound]
          name=lightning.ogg
        [/sound]
        [delay]
            time=10
        [/delay]
        [sound]
          name=magic-dark-big.ogg
        [/sound]
        [delay]
            time=20
        [/delay]
        [sound]
          name=lightning.ogg
        [/sound]
        [delay]
            time=10
        [/delay]
        [sound]
          name=magic-dark-big.ogg
        [/sound]
        [delay]
            time=20
        [/delay]
        [sound]
          name=lightning.ogg
        [/sound]
        [delay]
            time=10
        [/delay]
        [sound]
          name=magic-dark-big.ogg
        [/sound]
        [delay]
            time=20
        [/delay]
        [sound]
          name=lightning.ogg
        [/sound]
        [delay]
            time=10
        [/delay]
        [sound]
          name=magic-dark-big.ogg
        [/sound]
        [delay]
            time=20
        [/delay]
        [sound]
          name=lightning.ogg
        [/sound]
        [delay]
            time=10
        [/delay]
        [sound]
          name=magic-dark-big.ogg
        [/sound]
        [delay]
            time=100
        [/delay]
        {RESET_SCREEN}
        [terrain]
            x=9,13,11,15
            y=,9,7,12,10
            terrain=Gll
        [/terrain]
                            [remove_item]
                               x=9,13,11,15
                               y=,9,7,12,10
                            [/remove_item]
        [remove_sound_source]
             id=portal1
        [/remove_sound_source]
        [remove_sound_source]
             id=portal2
        [/remove_sound_source]
        [remove_sound_source]
             id=portal3
        [/remove_sound_source]
        [remove_sound_source]
             id=portal4
        [/remove_sound_source]
        {REPLACE_SCENARIO_MUSIC "silence.ogg"}
        [sound]
          name={SOUND_LIST:ELF_FEMALE_HIT}
        [/sound]
        [delay]
            time=1000
        [/delay]
        {REPLACE_SCENARIO_MUSIC "data/add-ons/TGA_Map_Music/music/snowfall.ogg"}
        [object]
            silent=yes
            duration=forever
            [filter]
                id=Boss1
            [/filter]
            [effect]
                apply_to=image_mod
                add="~O(98%)"
            [/effect]
        [effect]
            apply_to=hitpoints
            increase_total=-55
        [/effect]
        [/object]
        [delay]
            time=250
        [/delay]
        [sound]
          name={SOUND_LIST:ELF_FEMALE_HIT}
        [/sound]
                [message]
                    speaker=Boss1
                    image="portraits/transparent/heart_of_the_forest.png"
                    message= _ "<i>*sigh*, i failed, haven't i?...</i>"
                [/message]
        [object]
            silent=yes
            duration=forever
            [filter]
                id=Boss1
            [/filter]
            [effect]
                apply_to=image_mod
                add="~O(95%)"
            [/effect]
        [effect]
            apply_to=hitpoints
            increase_total=-55
        [/effect]
        [/object]
        [delay]
            time=250
        [/delay]
                [message]
                    speaker=Boss1
                    image="portraits/transparent/heart_of_the_forest.png~O(95%)"
                    message= _ "<i>i failed them all...</i>"
                [/message]
        [object]
            silent=yes
            duration=forever
            [filter]
                id=Boss1
            [/filter]
            [effect]
                apply_to=image_mod
                add="~O(92%)"
            [/effect]
        [effect]
            apply_to=hitpoints
            increase_total=-55
        [/effect]
        [/object]
        [delay]
            time=250
        [/delay]
                [message]
                    speaker=Boss1
                    image="portraits/transparent/heart_of_the_forest.png~O(92%)"
                    message= _ "<i>my people, my duty, everything...</i>"
                [/message]
        [object]
            silent=yes
            duration=forever
            [filter]
                id=Boss1
            [/filter]
            [effect]
                apply_to=image_mod
                add="~O(89%)"
            [/effect]
        [effect]
            apply_to=hitpoints
            increase_total=-55
        [/effect]
        [/object]
        [delay]
            time=250
        [/delay]
                [message]
                    speaker=Boss1
                    image="portraits/transparent/heart_of_the_forest.png~O(89%)"
                    message= _ "<i>the pursuit of vengeance has lead me to such paths, that i wouldn't even dare to think of back then...</i>"
                [/message]
        [object]
            silent=yes
            duration=forever
            [filter]
                id=Boss1
            [/filter]
            [effect]
                apply_to=image_mod
                add="~O(86%)"
            [/effect]
        [effect]
            apply_to=hitpoints
            increase_total=-55
        [/effect]
        [/object]
        [delay]
            time=250
        [/delay]
                [message]
                    speaker=Boss1
                    image="portraits/transparent/heart_of_the_forest.png~O(86%)"
                    message= _ "<i>while trying to have my revenge on <b>them</b>, i killed many who weren't even involved at all...</i>"
                [/message]
        [object]
            silent=yes
            duration=forever
            [filter]
                id=Boss1
            [/filter]
            [effect]
                apply_to=image_mod
                add="~O(83%)"
            [/effect]
        [effect]
            apply_to=hitpoints
            increase_total=-55
        [/effect]
        [/object]
        [delay]
            time=250
        [/delay]
                [message]
                    speaker=Boss1
                    image="portraits/transparent/heart_of_the_forest.png~O(83%)"
                    message= _ "<i>after all i done, i guess i deserve it ...</i>"
                [/message]
#        [delay]
#            time=1000
#        [/delay]
        [object]
            silent=yes
            duration=forever
            [filter]
                id=Boss1
            [/filter]
            [effect]
                apply_to=image_mod
                add="~O(80%)"
            [/effect]
        [/object]
        [delay]
            time=250
        [/delay]
        [kill]
            type=Spook,Ghost,Elvish Warrior Spirit,Wraith,Shadow,Elvish Ancestor,Spectre,Nightgaunt,Elvish Forefather
            animate=no
            fire_event=no
        [/kill]
#possible names for Boss1: 'Amadriella' or 'Beladrielle' as her real name,'Urithralinde' or 'Urithia' as how she's called by her followers
                        [endlevel]
                            result=victory
                        [/endlevel]
    [/event]
    [event]
        name=victory
        first_time_only=no
        [delay]
            time=5000
        [/delay]
        {REPLACE_SCENARIO_MUSIC "silence.ogg"}
#        [delay]
#            time=1000
#        [/delay]
        [kill]
            side=1,2,3
            animate=no
            fire_event=no
        [/kill]
        {REPLACE_SCENARIO_MUSIC "journeys_end.ogg"}
        [remove_item]
        [/remove_item]
        [label]
            x=4
            y=5
            text= _ ""
            color=0,0,0
        [/label]
        [label]
            x=8
            y=2
            text= _ ""
            color=0,0,0
        [/label]
        [label]
            x=17
            y=19
            text= _ ""
            color=0,0,0
        [/label]
        [label]
            x=21
            y=16
            text= _ ""
            color=0,0,0
        [/label]
        [label]
            x=12
            y=2
            text= _ ""
            color=0,0,0
        [/label]
        [label]
            x=13
            y=19
            text= _ ""
            color=0,0,0
        [/label]
        {FADE_TO_BLACK}
        [interim_text]
            text= _ "<i>The End </i>"
        [/interim_text]
        [interim_text]
            text= _ "<i>Credits: </i>"
        [/interim_text]
        [interim_text]
            text= _ "<i>                        Music Used:
                        underground.ogg - Aleksi Aubry-Carlson
                        ambuscade.ogg - Mattias Westlund
                        one_thousand_suns.ogg - Tyler Johnson
                        snowfall.ogg -Jeremy Nicoll
                        journeys_end.ogg - Mattias Westlund</i>"
        [/interim_text]
        [interim_text]
            text= _ "<i>                        Art:
                        I used works of many people, so i probably forgot most of them, but anyways huge thanks guys (and maybe gals too, i don't know)!</i>"
        [/interim_text]
        [interim_text]
            text= _ "<i>                        Testers (i played together with them in MP):
                        Those who i (the developer of The Golden Age) personally played with:

                        Lumen (the first tester)
                        Paulomat4 (he's also an addon developer too, he's the creator of Dawn of Thunder, and Global Unitmarker)</i>
                        
                        Those who just gave me feedback on the forums:
                        Nobody so far :|"
        [/interim_text]
        [interim_text]
            text= _ "<i>
                        I would appreciate any feedback for this map or TGA overall on the Battle for Wesnoth forums. if you leave feedback about this map, i will most likely include you in these credits.</i>"
        [/interim_text]
        [interim_text]
            text= _ "<i>Also, the last but not least, thanks to Shadowmaster, the Author of the IftU series for making such a masterpiece that inspired me to make this in the first place/</i>"
        [/interim_text]
        [interim_text]
            text= _ "<i>And, of course, thanks for playing! </i>"
        [/interim_text]
		[clear_print]
		[/clear_print]
                        {FADE_IN}
        [delay]
            time=2500
        [/delay]
#                        [endlevel]
#                            result=victory
#                        [/endlevel]
    [/event]
[event]
id=rushest_TGA
name=recruit
first_time_only=no
[filter]
	canrecruit=no
[/filter]
		[if]
		        [variable]
			    name=EXI_Rush
		            not_equals=yes
			[/variable]
			[then]
  {VARIABLE unit.moves $unit.max_moves}
  {VARIABLE unit.attacks_left $unit.max_attacks_left}  
[unstore_unit]
variable=unit
text=_"go go go"
{COLOR_HEAL}
[/unstore_unit] 
			[/then]
                    [else]
                    [/else]
		[/if]
[/event]
[event]
  id=cf_riplooted
  name=die
  first_time_only=no  
        [filter]
           side=3
        [/filter]
		[if]
		        [variable]
			    name=EXI_Killbounty
		            not_equals=yes
			[/variable]
			[then]
        [store_unit]
            [filter]
                id=$unit.id
            [/filter]
            variable=looted
            kill=yes
        [/store_unit]
		[if]
		    [variable]
			    name=looted.level
		            equals=0
			[/variable]
			[then]
  {VARIABLE_OP hit rand (0,0,0,0,1,1,1,1,2,2)}
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=looted.level
		            equals=1
			[/variable]
			[then]
  {VARIABLE_OP hit rand (0,1,1,1,1,1,1,2,2,2,2,2,3,3,3,3,4)}
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=looted.level
		            equals=2
			[/variable]
			[then]
  {VARIABLE_OP hit rand (1,1,1,1,2,2,2,2,2,3,3,3,3,3,3,4,4,4,5,5,5,6,6)}
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=looted.level
		            equals=3
			[/variable]
			[then]
  {VARIABLE_OP hit rand (1,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,5,5,5,6,6,6,6,7,7)}
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=looted.level
		            equals=4
			[/variable]
  {VARIABLE_OP hit rand (2,2,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,6,6,6,6,6,7,7,7,7,8,8,8,9)}
			[then]
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=looted.level
		            equals=5
			[/variable]
			[then]
  {VARIABLE_OP hit rand (4,4,4,4,5,5,5,5,6,6,6,6,6,7,7,7,7,8,8,8,9,9,9,10,10,11)}
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=looted.level
		            greater_than=5
			[/variable]
			[then]
  {VARIABLE_OP hit rand (5,6,6,6,6,6,7,7,7,7,8,8,8,9,9,9,10,10,11,12,13,14,15)}
		    [/then]
		[/if]
		[if]
		    [variable]
			    name=hit
		            greater_than=0
			[/variable]
			[then]
  [gold]
         side=$second_unit.side
         amount=$hit
  [/gold]
  [sound]
         name=gold.ogg
  [/sound]
  [unstore_unit]
         variable=second_unit
         text="<span color='#cccc33'> $hit| gold </span>"
  [/unstore_unit]
		    [/then]
		[/if]
{CLEAR_VARIABLE hit}
			[/then]
                    [else]
                    [/else]
		[/if]
[/event]
#enddef
#define CAMPFIRE_EVENT
[event]
    name=new turn
    first_time_only=no
	    [set_variable]
		    name=turndelay
		    sub=1
	    [/set_variable]
        [if]
            [variable]
                name=turndelay
                equals_to=0
            [/variable]
            [then]
	    [set_variable]
		    name=torches1
		    add=1
	    [/set_variable]
	    [set_variable]
		    name=torches2
		    add=1
	    [/set_variable]
	    [set_variable]
		    name=torches3
		    add=1
	    [/set_variable]
	    [set_variable]
		    name=torches4
		    add=1
	    [/set_variable]
	    [set_variable]
		    name=turndelay
		    value=4
	    [/set_variable]
            [/then]
            [else]
            [/else]
        [/if]
#this is done to (partly) fix the fact that lightning destroy any [item]s like portals
        [if]
            [variable]
                name=bossstage
                greater_than=1
            [/variable]
            [then]
                            [remove_item]
                                x=9,13,11,15
                                y=9,7,12,10
                            [/remove_item]
                            [item]
                                x=9,13,11,15
                                y=9,7,12,10
                                image=halo/portal-halo.png#:100,halo/portal-halo.png~SIZE(76,76):100,halo/portal-halo.png~SIZE(80,80):100,halo/portal-halo.png~SIZE(84,84):100,halo/portal-halo.png~SIZE(88,88):100,halo/portal-halo.png~SIZE(84,84):100,halo/portal-halo.png~SIZE(80.80):100,halo/portal-halo.png~SIZE(76,76):100
                            [/item]
            [/then]
            [else]
            [/else]
        [/if]
[/event]
#enddef
#define CAMPFIRE NUMBER X Y
        [label]
            x,y={X},{Y}
            text= _ "Campfire"
            color=255,175,0
        [/label]
#the sound idea failed
		[if]
		    [variable]
			    name=campfire_sound
		            equals=yes
			[/variable]
			[then]
        [sound_source]
            id=campfire{NUMBER}
            sounds=ambient/campfire.ogg
            delay=9000
            chance=100
            check_fogged=no
            check_shrouded=no
            x,y={X},{Y}
            full_range=2
            fade_range=2
            loop=0
        [/sound_source]
			[/then]
		[/if]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1,2
            x,y={X},{Y}
        [/filter]
                [message]
                    speaker=narrator
                    side_for=$unit.side|
                    message="Give this unit a torch? (units with a torch have the 'illuminates' ability) Torches: $torches{NUMBER}| / turns remaining until a new torch is created: $turndelay|"

                    [option]
                        message=  {MENU_IMG_TXT "attacks/blank-attack.png" _"No"}
                        [command]
                        [/command]
                    [/option]
                    [option]
                        message=  {MENU_IMG_TXT "attacks/torch.png" _"Yes"}
                        [command]
                            [if]
                                [variable]
                                    name=torches{NUMBER}
                                    greater_than=0
                                [/variable]

                                [then]
		[if]
		    [variable]
			    name=firehalo
		            equals=yes
			[/variable]
			[then]
                [message]
                    speaker=narrator
                    side_for=$unit.side|
                    message="Give this unit an illuminates-like fire halo, or just a torch overlay? (note: the halo option overrides any existing halo on the unit)"

                    [option]
                        message=  {MENU_IMG_TXT "attacks/torch.png" _"Fire Halo"}
                        [command]
        [object]
          silent=yes
          duration=forever
         [filter]
             x,y={X},{Y}           
         [/filter]
        silent=yes
        [effect]
            apply_to=halo
            halo="halo/fire-halo.png:250,halo/fire-halo.png~O(98%):250,halo/fire-halo.png~O(95%):250,halo/fire-halo.png~O(92%):250,halo/fire-halo.png~O(89%):250,halo/fire-halo.png~O(86%):250,halo/fire-halo.png~O(83%):250,halo/fire-halo.png~O(80%):250,halo/fire-halo.png~O(83%):250,halo/fire-halo.png~O(86%):250,halo/fire-halo.png~O(89%):250,halo/fire-halo.png~O(92%):250,halo/fire-halo.png~O(95%):250,halo/fire-halo.png~O(98%):250"
        [/effect]
    [/object]
                        [/command]
                    [/option]
                    [option]
                        message=  {MENU_IMG_TXT "attacks/torch.png" _"Torch overlay"}
                        [command]
                                    [unit_overlay]
                                        x,y=$x1,$y1
                                        image=misc/torch-overlay.png
                                    [/unit_overlay]
                        [/command]
                    [/option]
                [/message]
		    [/then]
                [else]
                                    [unit_overlay]
                                        x,y=$x1,$y1
                                        image=misc/torch-overlay.png
                                    [/unit_overlay]
                [/else]
		[/if]
        [object]
          silent=yes
          duration=forever
         [filter]
           x,y=$x1,$y1
         [/filter]
		[effect]
			apply_to=new_ability
			[abilities]
				{ABILITY_ILLUMINATES}
			[/abilities]
		[/effect]
    [/object]
	    [set_variable]
		    name=torches{NUMBER}
		    sub=1
	    [/set_variable]
                                [/then]
                                [else]
                                    [message]
                                        speaker=narrator
                                        message= _ "There are no torches availiable."
                                    [/message]
                                [/else]
                            [/if]
                        [/command]
                    [/option]
                [/message]
    [/event]
#enddef
#define WITCHDOCTOR_HUT NUMBER X Y
    [event]
        name=moveto
        first_time_only=yes
        [filter]
            x,y={X},{Y}
        [/filter]
        [label]
            x,y={X},{Y}
            text= _ "Hermit's Hut"
            color=180,150,0
        [/label]
    [/event]
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1,2
            x,y={X},{Y}
        [/filter]
                [message]
                    speaker=narrator
                    image=portraits/orcish_witchdoctor.png         
                    caption="Orcish Hermit"
                    side_for=$unit.side|
                    message="What d'ya want?"

                    [option]
                        message=  {MENU_IMG_TXT "units/random-dice2.png" _"Gamble"}
                        [command]
[set_variable] 
name=finished
value=no
[/set_variable]



[while]
	[variable]
	name=finished
	equals=no
	[/variable]
	[do]
	[store_gold]
	side=$unit.side|
	variable=gold
	[/store_gold]
  
[message]
                    speaker=narrator
                    image=portraits/orcish_witchdoctor.png        
                    caption="Orcish Hermit"
                    side_for=$unit.side|
                    message= _ "Hrmph... Well, you know, i do have some gold lying around here. It's pretty much useless to me in this forsaken place, but, if you really want to, we could gamble a bit - you probably know the rules, but if you don't, here it is: both of us place an equal amount of gold, we spin the dice, and whoever wins, takes all of the betted gold. I don't really care that much about the money itself, but <i>mostly</i> the sheer thrill of playing."

{DICINGGAME 1 5}
{DICINGGAME 2 10}
{DICINGGAME 3 15}
{DICINGGAME 4 20}
{DICINGGAME 5 25}
  
[option]
	message= _ {MENU_IMG_TXT "icons/boots_elven.png" "Leave"}
	[command]
  
[set_variable] 
name=finished
value=yes
[/set_variable]


	[/command]
	[/option]


[/message]
[/do]
[/while]
                        [/command]
                    [/option]
[option]
	message= _ {MENU_IMG_TXT "icons/boots_elven.png" "Leave"}
	[command]
	[/command]
[/option]
                [/message]
    [/event]
#enddef
#define DICINGGAME DICES GOLD 


[option]
	message= _ {MENU_IMG_TXT "units/random-dice2.png" "Play a dice game ({DICES} dices) placing <span color='#cccc33'>{GOLD}</span> Gold!"}
	[command]

[set_variable]
name=minimum
value={DICES}
[/set_variable]  

[set_variable]
name=maximum
value={DICES}
[/set_variable]  

[set_variable]
name=maximum
multiply=6
[/set_variable]
  
  
[set_variable]
name=hedice
rand=$minimum..$maximum
[/set_variable]

[set_variable]
name=youdice
rand=$minimum..$maximum
[/set_variable]
  
[message]
speaker=narrator
image="units/random-dice2.png"
message= "You both place your <span color='#cccc33'>{GOLD} gp</span> and he starts to dice. The dices show <span color='#cccc33'>$hedice|</span>!
Than you take the dices, shake your hands and roll them over the table! <span color='#cccc33'>$youdice|</span>!"
[/message]

[if]
[variable]
name=youdice
greater_than=$hedice
[/variable]
[then]

[message]
            speaker=narrator
            image="units/random-dice2.png"
            message= "You have won! You receive the <span color='#cccc33'>{GOLD} Gold</span> from your opponent."
        [/message]
        
        
  [gold]
	side=1
	amount={GOLD}
	[/gold]
  [sound]
         name=gold.ogg
  [/sound]
[/then]
[/if]


[if]
[variable]
name=hedice
greater_than=$youdice
[/variable]
[then]

[message]
            speaker=narrator
            image="units/random-dice2.png"
            message= "You have lost, losing your <span color='#cccc33'>{GOLD} Gold</span>! What a disappaintment!"
        [/message]
        
  [gold]
	side=1
	amount=-{GOLD}
	[/gold]

[/then]
[/if]

[if]
[variable]
name=hedice
equals=$youdice
[/variable]
[then]

[message]
            speaker=narrator
            image="units/random-dice2.png"
            message= "Its a draw! You both take your placed gold back!"
        [/message]
[/then]
[/if]
[/command]
[/option]

#enddef
#define HELPTEXT SIDE
        [message]
            speaker=narrator
            caption="Help"
            image=portraits/book.png
            side_for={SIDE}
            message="Welcome to the corrupted forest map.
a few things to keep in mind:

1. in case you are playing as undead, you won't be able to recruit fallen sprite/fallen faeries due to storyline-related reasons. same stuff applies for woses for Sylvan.

2.the ToD cycle is different than usual, it's 1 turn day (morning, to be precise), 9 turns night, and 2 turns dawn/dusk.

3.some of the the ai-controlled enemies here have been given abilites like ambush/nightstalk/ect. to make stuff a bit spookier (having enemies appear out of nowhere ;) ).

4.when you hear a sound when the turn starts, it can mean that some new ai-controlled enemies spawn.

5.previously non-chaotic enemies have had their alignment switched to chaotic automatically
6.there are places where enemies tend to spawn in more often.  

7.every turn, two (and sometimes three (four in hard mode)) lightnings strike the ground in random places, dealing damage to any unit standing there (min. damage 10, max. 25) and giving them 'slowed' status.
8.every time a unit of side 1 or 2 dies, he/she/it is reanimated as a side 3 ghost of the unit's level minus 1 (or just simply unit's level in hard mode). there are variation for elves,drakes,riders and units with backstab.

9,you can get torches from campfires (they give the unit the 'illuminates' ability). new torches are produced every 4 turns

10.you might often hear wailing sounds, spooky, right?

11.units like 'Fallen Sprites' and 'Fallen Faeries' can teleport between trees, you can block this by placing units on great tree hexes

12.the huts in the forest can be used for gambling, pretty weird, isn't it?"
#?.pssst, there are two endings" #Not a true fact for now
        [/message]
#enddef
#define HELPMENU
[set_menu_item] 
	id=Help
	description=_ "Help"
	[show_if]
		[have_unit]
			x,y=$x1,$y1
			side=$side_number
                        canrecruit=yes
		[/have_unit]
	[/show_if]
			[command]
        {HELPTEXT "$side_number|"}
			[/command]
[/set_menu_item] 
#enddef
