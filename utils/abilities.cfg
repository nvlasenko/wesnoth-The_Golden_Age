#textdomain wesnoth-thot

#define SPECIAL_NOTES_INSPIRE
_" The presence of this unit inspires own units next to it to deal a bit more damage in combat, though this only applies to units of lower ,equal,or higher level."#enddef

#define ABILITY_INSPIRE_LEVEL_1
    # Canned definition of the Inspire (level 1) ability to be included in an
    # [abilities] clause.
    [leadership]
        id=inspire_0
        value=20
        cumulative=no
        name= _ "inspire"
        description= _ "This unit can inspire own units that are next to it, making them fight better. Adjacent own units of the unit's level will do 10% more damage, the ones that are just one level above, will do 5%, and unis of level below it will deal 10%+10% per level difference."
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=0
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=inspire_1
        value=10
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=1
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=inspire_2
        value=5
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=2
            [/filter]
        [/affect_adjacent]
    [/leadership]
#enddef
#define ABILITY_INSPIRE_LEVEL_2
    # Canned definition of the Inspire (level 2) ability to be included in an
    # [abilities] clause.
    [leadership]
        id=inspire_0
        value=30
        cumulative=no
        name= _ "inspire"
        description= _ "This unit can inspire own units that are next to it, making them fight better. Adjacent own units of the unit's level will do 10% more damage, the ones that are just one level above, will do 5%, and unis of level below it will deal 10%+10% per level difference."
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=0
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=inspire_1
        value=20
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=1
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=inspire_2
        value=10
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=2
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=inspire_3
        value=5
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=3
            [/filter]
        [/affect_adjacent]
    [/leadership]
#enddef
#define ABILITY_INSPIRE_LEVEL_3
    # Canned definition of the Inspire (level 3) ability to be included in an
    # [abilities] clause.
    [leadership]
        id=inspire_0
        value=40
        cumulative=no
        name= _ "inspire"
        description= _ "This unit can inspire own units that are next to it, making them fight better. Adjacent own units of the unit's level will do 10% more damage, the ones that are just one level above, will do 5%, and unis of level below it will deal 10%+10% per level difference."
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=0
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=inspire_1
        value=30
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=1
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=inspire_2
        value=20
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=2
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=inspire_3
        value=10
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=3
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=inspire_3
        value=5
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=4
            [/filter]
        [/affect_adjacent]
    [/leadership]
#enddef
#define ABILITY_INSPIRE_LEVEL_4
    # Canned definition of the Inspire (level 4) ability to be included in an
    # [abilities] clause.
    [leadership]
        id=inspire_0
        value=50
        cumulative=no
        name= _ "inspire"
        description= _ "This unit can inspire own units that are next to it, making them fight better. Adjacent own units of the unit's level will do 10% more damage, the ones that are just one level above, will do 5%, and unis of level below it will deal 10%+10% per level difference."
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=0
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=inspire_1
        value=40
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=1
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=inspire_2
        value=30
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=2
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=inspire_3
        value=20
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=3
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=inspire_4
        value=10
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=4
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=inspire_5
        value=5
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=5
            [/filter]
        [/affect_adjacent]
    [/leadership]
#enddef

#define ABILITY_LEAD_ANIM
    #just to make leading anim, render for units with protection ability
    [leadership]
        id=fakelead
        value=0
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
        [/affect_adjacent]
    [/leadership]
#enddef
#define ABILITY_PROTECTION VALUE
    [resistance]
        id=protection
        add={VALUE}
        max_value=40
#        apply_to=blade,pierce,impact,fire,cold,arcane
        name= _ "protection"
        description="Adjacent friendly units receive a +{VALUE}% bonus to all resistances (up to a maximum of 40%)."
        affect_self=no
        affect_allies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
        [/affect_adjacent]
        [filter_base_value]
            less_than=40
        [/filter_base_value]
    [/resistance]
#enddef
#define ABILITY_JINX VALUE
    [resistance]
        id=jinx
        sub={VALUE}
        max_value=100
#        apply_to=blade,pierce,impact,fire,cold,arcane
        name= _ "jinx"
        description="Adjacent enemy units receive -{VALUE}% to all resistances (up to a maximum of -30%)."
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
        [/affect_adjacent]
        [filter_base_value]
            greater_than=-30
        [/filter_base_value]
    [/resistance]
#enddef
#define ABILITY_ROUSING VALUE
    # Canned definition of the Inspire (level 1) ability to be included in an
    # [abilities] clause.
    [leadership]
        id=rousing
        value={VALUE}
        cumulative=yes
        name= _ "rousing"
        description= _ "This unit can rouse allies to fight like savages, dealing {VALUE}% more damage, the effect can be stacked with leadership or any other damage boosting ability."
        affect_self=no
        affect_allies=yes
        affect_enemies=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=inspire_1
        value=25
        cumulative=no
        affect_self=no
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=1
            [/filter]
        [/affect_adjacent]
    [/leadership]
#enddef
#define ABILITY_MOONLIGHT
    # Canned definition of the Moonlight ability to be included in an
    # [abilities] clause.
    [leadership]
        id=moonlightdamnight
        value=15
        cumulative=no
        name= _ "moonlight"
        description= _ "At night this unit deals +15%  damage regenerates 4 hp and removes poison , gains 15% resistatance bonus and ignores ZOC."
        affect_self=yes
        [filter]
            [filter_location]
                time_of_day=chaotic
            [/filter_location]
        [/filter]
    [/leadership]
    [skirmisher]
        id=moonlightskirmisher
        affect_self=yes
        [filter]
            [filter_location]
                time_of_day=chaotic
            [/filter_location]
        [/filter]
    [/skirmisher]
    [resistance]
        id=moonlightresnight
        add=15
        max_value=25
#        apply_to=blade,pierce,impact,fire,cold,arcane
        affect_self=yes
        affect_allies=no
        [filter_base_value]
            less_than=25
        [/filter_base_value]
        [filter]
            [filter_location]
                time_of_day=chaotic
            [/filter_location]
        [/filter]
    [/resistance]
    [resistance]
        id=moonlightrestwilight
        add=5
        max_value=25
#        apply_to=blade,pierce,impact,fire,cold,arcane
        affect_self=yes
        affect_allies=no
        [filter_base_value]
            less_than=25
        [/filter_base_value]
        [filter]
            [filter_location]
                time_of_day=neutral
            [/filter_location]
        [/filter]
    [/resistance]
    [regenerate]
        id=moonlightregennight
        affect_self=yes
        value=4
        poison=cured
        [filter]
            [filter_location]
                time_of_day=chaotic
            [/filter_location]
        [/filter]
    [/regenerate]
    [regenerate]
        id=moonlightregentwilight
        affect_self=yes
        value=2
        poison=slowed
        [filter]
            [filter_location]
                time_of_day=neutral
            [/filter_location]
        [/filter]
    [/regenerate]
#enddef
#define ABILITY_CAMOUFLAGE
    [hides]
        id=camouflage
        name= _ "camouflage"
        female_name= _ "female^camouflage"
        name_inactive= _ "camouflage"
        female_name_inactive= _ "female^camouflage"
        description= _ "This unit can hide in the desert, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in the desert, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        description_inactive= _ "This unit can hide in the desert, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in the desert, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        affect_self=yes
        [filter_self]
            [filter_location]
                #terrain=Md,Ds,Dd,Dd^Dc,Md^Xm,Dd^Do,Dd^Vda,Dd^Vdt,Hd
                terrain=Md,Ds,Dd,Dd^*,Md^*,Hd
            [/filter_location]
        [/filter_self]
    [/hides]
#enddef
#define ABILITY_ICEHOME VALUE
    [regenerate]
        value={VALUE}
        id=icehome
        name= _ "icehome +{VALUE}"
        description="At the beginning of each turn this unit heals +{VALUE} hp when standing on cold terrain. If it is poisoned, it will remove it instead of healing."
        name_inactive= _ "icehome +{VALUE}"
        description_inactive="At the beginning of each turn this unit heals +6 hp when standing on cold terrain. If it is poisoned, it will remove it instead of healing."
        affect_self=yes
        poison=cured
        [filter_self]
            [filter_location]
                terrain=At,Ai
            [/filter_location]
        [/filter_self]
    [/regenerate]
#enddef
#define ABILITY_REGENERATES_VALUE VALUE
    [regenerate]
        value={VALUE}
        id=regenerates
        name= _ "regenerates +{VALUE}"
        description="At the beginning of each turn this unit heals +{VALUE} hp. If it is poisoned, it will remove it instead of healing."
        name_inactive= _ "regenerates +{VALUE}"
        description_inactive="At the beginning of each turn this unit heals +6 hp. If it is poisoned, it will remove it instead of healing."
        affect_self=yes
        poison=cured
    [/regenerate]
#enddef
#define ABILITY_DARKENS
    [illuminates]
        id=darkens
        value=-25
        min_value=-25
        max_value=25
        cumulative=no
        affect_self=yes
        name= _ "darkens"
        female_name= _ "female^darkens"
        description= _ "This unit darkens the surrounding area, making chaotic units fight better, and lawful units fight worse.

Any units adjacent to this unit will fight as if it were dusk when it is day, and as if it were night when it is dusk."
    [/illuminates]
#enddef
#define ABILITY_EXTRA_HEAL_12
    [heals]
        value=12
        id=healing
        affect_allies=yes
        name= _ "heals +12"
        female_name= _ "female^heals +12"
        description= _ "This unit combines herbal remedies with magic to heal units more quickly than is normally possible on the battlefield.
A unit cared for by this healer may heal up to 12 HP per turn, or stop poison from taking effect for that turn.
A poisoned unit cannot be cured of its poison by a healer and must seek the care of a village or a unit that can cure."
        affect_self=no
        poison=slowed
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
        [/affect_adjacent]
    [/heals]
#enddef

#define ABILITY_SWAMPAMBUSH
    [hides]
        id=swampambush
        name= _ "swamp ambush"
        name_inactive= _ "swamp ambush"
        description="This unit can hide in swamp, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in swamp, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        description_inactive="This unit can hide in swamp, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in swamp, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        affect_self=yes
        [filter_self]
            [filter_location]
                terrain=Ss
            [/filter_location]
        [/filter_self]
    [/hides]
#enddef

#define ABILITY_WATERAMBUSH
    [hides]
        id=waterambush
        name= _ "water ambush"
        name_inactive= _ "water ambush"
        description="This unit can hide in water, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in water, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        description_inactive="This unit can hide in water, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in water, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        affect_self=yes
        [filter_self]
            [filter_location]
                terrain=Ww,Wo
            [/filter_location]
        [/filter_self]
    [/hides]
#enddef

#define ABILITY_CAVEAMBUSH
    [hides]
        id=caveambush
        name= _ "cave ambush"
        name_inactive= _ "cave ambush"
        description={ABILITY_CAPTION (_"Cave Ambush")}+_"This unit can hide in cave, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in cave, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        description_inactive={ABILITY_CAPTION (_"Cave Ambush")}+_"This unit can hide in cave, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in cave, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        affect_self=yes
        [filter_self]
            [filter_location]
                terrain=Uu,Ur,Uh
            [/filter_location]
        [/filter_self]
    [/hides]
#enddef

#define ABILITY_REGENERATES_6
    [regenerate]
        value=6
        id=regen6
        name= _ "regenerates +6"
        description={ABILITY_CAPTION (_"Regenerates +6")}+_"At the beginning of each turn this unit heals +6 hp. If it is poisoned, it will remove it instead of healing."
        name_inactive= _ "regenerates +6"
        description_inactive={ABILITY_CAPTION (_"Regenerates +6")}+_"At the beginning of each turn this unit heals +6 hp. If it is poisoned, it will remove it instead of healing."
        affect_self=yes
        poison=cured
    [/regenerate]
#enddef
#define ABILITY_HEALS_2
    # Canned definition of the heal+2 ability to be included in an [abilities] clause.
    [heals]
        value=2
        id=healing
        affect_allies=yes
        name= _ "heals +2"
        female_name= _ "female^heals +2"
        description=  _ "Allows the unit to heal adjacent allied units at the beginning of our turn.

A unit cared for by this healer may heal up to 2 HP per turn, or stop poison from taking effect for that turn.
A poisoned unit cannot be cured of its poison by a healer, and must seek the care of a village or a unit that can cure."
        affect_self=no
        poison=slowed
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
        [/affect_adjacent]
    [/heals]
#enddef
#define ABILITY_HEALS_6
    # Canned definition of the heal+6 ability to be included in an [abilities] clause.
    [heals]
        value=6
        id=healing
        affect_allies=yes
        name= _ "heals +6"
        female_name= _ "female^heals +6"
        description=  _ "Allows the unit to heal adjacent allied units at the beginning of our turn.

A unit cared for by this healer may heal up to 6 HP per turn, or stop poison from taking effect for that turn.
A poisoned unit cannot be cured of its poison by a healer, and must seek the care of a village or a unit that can cure."
        affect_self=no
        poison=slowed
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
        [/affect_adjacent]
    [/heals]
#enddef
#define ABILITY_TREEWALK
   [teleport]
      id=treewalk
      name=_"treewalk"
      female_name=_"female^treewalk"
      description=_"This unit may teleport between any two great trees using one of its moves."
      [tunnel]
         id=tree_teleport
         [source]
            terrain=*^Fet,*^Fetd
            [not]
               [filter]
                  [not]
                     id=$teleport_unit.id
                  [/not]
               [/filter]
            [/not]
         [/source]
         [target]
            terrain=*^Fet,*^Fetd
            [not]
               [filter]
               [/filter]
            [/not]
         [/target]
         [filter]
            ability=treewalk
         [/filter]
      [/tunnel]
   [/teleport]
#enddef
#define ABILITY_SELFHEAL
    # Canned definition of the Selfheal ability to be included in an [abilities]
    # clause.
    [regenerate]
        value=4
        id=selfheal
        name= _ "selfheal"
        female_name= _ "female^seflheal"
        description= _ "The unit will heal itself 4 HP per turn. If it is poisoned, it will stop the poison from taking effect, but not removing it instead of healing."
        affect_self=yes
        poison=slowed
    [/regenerate]
#enddef

#define ABILITY_PHOTOREGENERATES
    [regenerate]
        id=regenerates_day
        name= _ "Photoregenerates"
        female_name= _ "female^Photoregenerates"
        description= _ "The unit will heal itself 8 HP per turn at day and cure itself. This unit will heal itself 4 HP at twilight."
        affect_self=yes
        value=8
        poison=cured
        [filter]
            [filter_location]
                time_of_day=lawful
            [/filter_location]
        [/filter]
    [/regenerate]
    [regenerate]
        id=regenerates_twilight
        affect_self=yes
        value=4
        [filter]
            [filter_location]
                time_of_day=neutral
            [/filter_location]
        [/filter]
    [/regenerate]
#enddef
#define ABILITY_STRENGTH_OF_DARKNESS_4
    [regenerate]
        id=regenerates_night6
        name= _ "lesser strength of darkness +4"
        female_name= _ "female^lesser strength of darkness +4"
        description= _ "The unit will heal itself 4 HP per turn at night. This unit will heal itself 2 HP at twilight."
        affect_self=yes
        value=4
        poison=slowed
        [filter]
            [filter_location]
                time_of_day=chaotic
            [/filter_location]
        [/filter]
    [/regenerate]
    [regenerate]
        id=regenerates_twilight
        affect_self=yes
        value=2
        poison=slowed
        [filter]
            [filter_location]
                time_of_day=neutral
            [/filter_location]
        [/filter]
    [/regenerate]
#enddef
#define ABILITY_STRENGTH_OF_DARKNESS_6
    [regenerate]
        id=regenerates_night6
        name= _ "lesser strength of darkness +6"
        female_name= _ "female^lesser strength of darkness +6"
        description= _ "The unit will heal itself 6 HP per turn at night. This unit will heal itself 3 HP at twilight."
        affect_self=yes
        value=6
        poison=slowed
        [filter]
            [filter_location]
                time_of_day=chaotic
            [/filter_location]
        [/filter]
    [/regenerate]
    [regenerate]
        id=regenerates_twilight
        affect_self=yes
        value=3
        poison=slowed
        [filter]
            [filter_location]
                time_of_day=neutral
            [/filter_location]
        [/filter]
    [/regenerate]
#enddef
#define ABILITY_STRENGTH_OF_DARKNESS
    [regenerate]
        id=regenerates_night
        name= _ "strength of darkness +8"
        female_name= _ "female^strength of darkness +8"
        description= _ "The unit will heal itself 8 HP per turn at night and cure itself. This unit will heal itself 4 HP at twilight."
        affect_self=yes
        value=8
        poison=cured
        [filter]
            [filter_location]
                time_of_day=chaotic
            [/filter_location]
        [/filter]
    [/regenerate]
    [regenerate]
        id=regenerates_twilight
        affect_self=yes
        value=4
        poison=slowed
        [filter]
            [filter_location]
                time_of_day=neutral
            [/filter_location]
        [/filter]
    [/regenerate]
#enddef
#define ABILITY_STRENGTH_OF_DARKNESS_10
    [regenerate]
        id=regenerates_night10
        name= _ "strength of darkness +10"
        female_name= _ "female^strength of darkness +10"
        description= _ "The unit will heal itself 10 HP per turn at night and cure itself. This unit will heal itself 5 HP at twilight."
        affect_self=yes
        value=10
        poison=cured
        [filter]
            [filter_location]
                time_of_day=chaotic
            [/filter_location]
        [/filter]
    [/regenerate]
    [regenerate]
        id=regenerates_twilight
        affect_self=yes
        value=5
        poison=cured
        [filter]
            [filter_location]
                time_of_day=neutral
            [/filter_location]
        [/filter]
    [/regenerate]
#enddef
#define ABILITY_STRENGTH_OF_DARKNESS_16
    [regenerate]
        id=regenerates_night16
        name= _ "greater strength of darkness +16"
        female_name= _ "female^greater strength of darkness +16"
        description= _ "The unit will heal itself 16 HP per turn at night and cure itself. This unit will heal itself 8 HP at twilight and cure itself."
        affect_self=yes
        value=16
        poison=cured
        [filter]
            [filter_location]
                time_of_day=chaotic
            [/filter_location]
        [/filter]
    [/regenerate]
    [regenerate]
        id=regenerates_twilight
        affect_self=yes
        value=8
        poison=cured
        [filter]
            [filter_location]
                time_of_day=neutral
            [/filter_location]
        [/filter]
    [/regenerate]
#enddef
#define SPECIAL_NOTES_STRENGTH_OF_DARKNESS
_ "This unit will heal itself 8 HP per turn at night and cure itself. This unit will heal itself 4 HP at twilight."#enddef

#define ABILITY_STRENGTH_OF_DARKNESS_24
    [regenerate]
        id=regenerates_night
        name= _ "greater strength of darkness +24"
        female_name= _ "female^greater strength of darkness +24"
        description= _ "The unit will heal itself 24 HP per turn at night and cure itself. This unit will heal itself 12 HP at twilight and cure itself."
        affect_self=yes
        value=24
        poison=cured
        [filter]
            [filter_location]
                time_of_day=chaotic
            [/filter_location]
        [/filter]
    [/regenerate]
    [regenerate]
        id=regenerates_twilight
        affect_self=yes
        value=12
        poison=cured
        [filter]
            [filter_location]
                time_of_day=neutral
            [/filter_location]
        [/filter]
    [/regenerate]
#enddef

#define ABILITY_STRENGTH_OF_DARKNESS_CUSTOM NIGHTHEAL TWILIGHTHEAL
    [regenerate]
        id=regenerates_night_custom
        name= _ "strength of darkness +{NIGHTHEAL}"
        female_name= _ "female^strength of darkness +{NIGHTHEAL}"
        description= _ "The unit will heal itself {NIGHTHEAL} HP per turn at night and cure itself. This unit will heal itself {TWILIGHTHEAL} HP at twilight."
        affect_self=yes
        value={NIGHTHEAL}
        poison=cured
        [filter]
            [filter_location]
                time_of_day=chaotic
            [/filter_location]
        [/filter]
    [/regenerate]
    [regenerate]
        id=regenerates_twilight
        affect_self=yes
        value={TWILIGHTHEAL}
        poison=slowed
        [filter]
            [filter_location]
                time_of_day=neutral
            [/filter_location]
        [/filter]
    [/regenerate]
#enddef

#define __ABILITY_TSTRING_TERROR
    name= _ "terror"
    description= _ "This unit can frighten enemy units that are next to it, making them fight worse.
Adjacent enemy units of lower level will do less damage in battle. When an enemy unit of the same or lower level is adjacent and engages in combat, its attacks do 15% less damage times the difference in their levels + 15%. doesn't work on non-living beings."
#enddef

#define ABILITY_TERROR_LEVEL_1
    [leadership]
        id=terror
        value=-30
        cumulative=no
        {__ABILITY_TSTRING_TERROR}
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=0
       [and]       
        [not]
            [filter_wml]
                [status]
                    not_living="yes"
                [/status]
            [/filter_wml]
        [/not]
       [/and]
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=terror
        value=-15
        cumulative=no
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=1
       [and]       
        [not]
            [filter_wml]
                [status]
                    not_living="yes"
                [/status]
            [/filter_wml]
        [/not]
       [/and]
            [/filter]
        [/affect_adjacent]
    [/leadership]
#enddef

#define ABILITY_TERROR_LEVEL_2
    [leadership]
        id=terror
        value=-45
        cumulative=no
        {__ABILITY_TSTRING_TERROR}
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=0
       [and]       
        [not]
            [filter_wml]
                [status]
                    not_living="yes"
                [/status]
            [/filter_wml]
        [/not]
       [/and]
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=terror
        value=-30
        cumulative=no
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=1
       [and]
        [not]
            [filter_wml]
                [status]
                    not_living="yes"
                [/status]
            [/filter_wml]
        [/not]
       [/and]
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=terror
        value=-15
        cumulative=no
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=2
       [and]
        [not]
            [filter_wml]
                [status]
                    not_living="yes"
                [/status]
            [/filter_wml]
        [/not]
       [/and]
            [/filter]
        [/affect_adjacent]
    [/leadership]
#enddef

#define ABILITY_TERROR_LEVEL_3
    [leadership]
        id=terror
        value=-60
        cumulative=no
        {__ABILITY_TSTRING_TERROR}
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=0
       [and]
        [not]
            [filter_wml]
                [status]
                    not_living="yes"
                [/status]
            [/filter_wml]
        [/not]
       [/and]
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=terror
        value=-45
        cumulative=no
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=1
       [and]
        [not]
            [filter_wml]
                [status]
                    not_living="yes"
                [/status]
            [/filter_wml]
        [/not]
       [/and]
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=terror
        value=-30
        cumulative=no
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=2
       [and]
        [not]
            [filter_wml]
                [status]
                    not_living="yes"
                [/status]
            [/filter_wml]
        [/not]
       [/and]
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=terror
        value=-15
        cumulative=no
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=3
       [and]
        [not]
            [filter_wml]
                [status]
                    not_living="yes"
                [/status]
            [/filter_wml]
        [/not]
       [/and]
            [/filter]
        [/affect_adjacent]
    [/leadership]
#enddef
#define ABILITY_TERROR_LEVEL_4
    [leadership]
        id=terror
        value=-75
        cumulative=no
        {__ABILITY_TSTRING_TERROR}
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=0
       [and]
        [not]
            [filter_wml]
                [status]
                    not_living="yes"
                [/status]
            [/filter_wml]
        [/not]
       [/and]
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=terror
        value=-60
        cumulative=no
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=1
       [and]
        [not]
            [filter_wml]
                [status]
                    not_living="yes"
                [/status]
            [/filter_wml]
        [/not]
       [/and]
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=terror
        value=-45
        cumulative=no
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=2
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=terror
        value=-30
        cumulative=no
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=3
       [and]
        [not]
            [filter_wml]
                [status]
                    not_living="yes"
                [/status]
            [/filter_wml]
        [/not]
       [/and]
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=terror
        value=-15
        cumulative=no
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=4
       [and]
        [not]
            [filter_wml]
                [status]
                    not_living="yes"
                [/status]
            [/filter_wml]
        [/not]
       [/and]
            [/filter]
        [/affect_adjacent]
    [/leadership]
#enddef
#define ABILITY_TERROR_LEVEL_5
    [leadership]
        id=terror
        value=-90
        cumulative=no
        {__ABILITY_TSTRING_TERROR}
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=0
       [and]
        [not]
            [filter_wml]
                [status]
                    not_living="yes"
                [/status]
            [/filter_wml]
        [/not]
       [/and]
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=terror
        value=-75
        cumulative=no
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=1
       [and]
        [not]
            [filter_wml]
                [status]
                    not_living="yes"
                [/status]
            [/filter_wml]
        [/not]
       [/and]
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=terror
        value=-60
        cumulative=no
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=2
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=terror
        value=-45
        cumulative=no
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=3
       [and]
        [not]
            [filter_wml]
                [status]
                    not_living="yes"
                [/status]
            [/filter_wml]
        [/not]
       [/and]
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=terror
        value=-30
        cumulative=no
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=4
       [and]
        [not]
            [filter_wml]
                [status]
                    not_living="yes"
                [/status]
            [/filter_wml]
        [/not]
       [/and]
            [/filter]
        [/affect_adjacent]
    [/leadership]
    [leadership]
        id=terror
        value=-15
        cumulative=no
        affect_self=no
        affect_allies=no
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                level=5
       [and]
        [not]
            [filter_wml]
                [status]
                    not_living="yes"
                [/status]
            [/filter_wml]
        [/not]
       [/and]
            [/filter]
        [/affect_adjacent]
    [/leadership]
#enddef

#define ABILITY_SYLVAN_SPARK
    [regenerate]
        value=5
        id=sylvan_spark
        name= _ "sylvan spark"
        description= _ "While in vegetated terrains, the unit will heal itself 5 hp per turn. If it is poisoned, it will remove the poison instead of healing."
        name_inactive= _ "sylvan spark"
        description_inactive= _ "While in vegetated terrains, the unit will heal itself 5 hp per turn. If it is poisoned, it will remove the poison instead of healing."
        affect_self=yes
        [filter_self]
            [filter_location]
                terrain=*^F*, *^Uf, *^Ufi
            [/filter_location]
        [/filter_self]
        poison=cured
    [/regenerate]
#enddef

#define ABILITY_REGENERATES+24
    [regenerate]
        value=24
        id=regenerates+24
        name= _ "regenerates"
        female_name= _ "female^regenerates"
        description= _ "This unit will heal itself 24 HP per turn. If it is poisoned, it will remove the poison instead of healing."
        affect_self=yes
        poison=cured
    [/regenerate]
#enddef

#define ABILITY_FAMILIAR
    [teleport]
        id=familiar
        name= _ "familiar"
        female_name= _ "female^familiar"
        description= _ "This unit may teleport to allied units."
        [tunnel]
            id=familiar
            [source]
                terrain=*
            [/source]
            [filter]
                ability=familiar
            [/filter]
            [target]
				[filter_adjacent_location]
					[filter]
						side=$teleport_unit.side
					[/filter]       
				[/filter_adjacent_location]  			         
            [/target]
        [/tunnel]
    [/teleport]
#enddef
#define ABILITY_DIG
    [dummy]
        id=dig
        name= _ "dig"
		description= _ "This unit Is able to dig itself through cave walls. For the cost of four mp it can change the terrain of an adjacent cave wall to cave ground."
    [/dummy]
#enddef

#define MOVES_NO_LESS_THAN_4
[and]
	[not]
		[filter_wml]
			moves=4
		[/filter_wml]
	[/not]
[/and]
[and]
	[not]
		[filter_wml]
			moves=3
		[/filter_wml]
	[/not]
[/and]
[and]
	[not]
		[filter_wml]
			moves=2
		[/filter_wml]
	[/not]
[/and]
[and]
	[not]
		[filter_wml]
			moves=1
		[/filter_wml]
	[/not]
[/and]
[and]
	[not]
		[filter_wml]
			moves=0
		[/filter_wml]
	[/not]
[/and]
#enddef


#define ABILITY_DIG_EVENT
    [event]
#        name=side turn
        name=start
        first_time_only=no

        [set_menu_item]
            [show_if]
                [have_location]
                    terrain=Xu*
                    x,y=$x1,$y1
                    [filter_adjacent_location]
                        [filter]
                            side=$side_number
#							[and]
#								type=Dwarvish Miner
#							[/and]
							[and]
								ability=dig
							[/and]
							[and]
								{MOVES_NO_LESS_THAN_4}
							[/and]
                        [/filter]
                    [/filter_adjacent_location]
                [/have_location]
            [/show_if]
            id=dig_cavewall
            description= _ "dig into this cave wall"
			image=misc/shovelicon.png
            [command]
                [sound]
                    name=mace.wav
					repeat=3
                [/sound]
				
				[if]
					[variable]
						name=x1
						equals=20
					[/variable]
					[and]
						[variable]
							name=y1
							equals=12
						[/variable]
					[/and]
					[or]
						[variable]
							name=x1
							equals=21
						[/variable]
						[and]
							[variable]
								name=y1
								equals=13
							[/variable]
						[/and]
					[/or]
					[then]
						[terrain]
							terrain=Uu^Br\
							x,y=$x1,$y1
						[/terrain]
					[/then]
					[else]
						[if]
							[variable]
								name=x1
								equals=19
							[/variable]
							[and]
								[variable]
									name=y1
									equals=17
								[/variable]
							[/and]
							[then]
								[terrain]
									terrain=Uu^Br/
									x,y=$x1,$y1
								[/terrain]
							[/then]
							[else]
								[if]
									[variable]
										name=x1
										equals=7
									[/variable]
									[and]
										[variable]
											name=y1
											equals=14
										[/variable]
									[/and]
									[then]
										[terrain]
											terrain=Uu^Br|
											x,y=$x1,$y1
										[/terrain]
									[/then]
									[else]
										[terrain]
											terrain=Uu^Dr
											x,y=$x1,$y1
										[/terrain]
									[/else]
								[/if]
							[/else]
						[/if]
					[/else]
				[/if]
				
                # teleport the miner to the newly created cave
                [store_unit]
                    [filter]
                        side=$side_number
						[and]
							type=Dwarvish Miner
						[/and]
						[and]
							ability=dig
						[/and]
						[and]
							{MOVES_NO_LESS_THAN_4}
						[/and]
                        [filter_location]
                            [filter_adjacent_location]
                                x,y=$x1,$y1
                            [/filter_adjacent_location]
                        [/filter_location]
                    [/filter]
                    variable=miner
                    kill=yes
                [/store_unit]

                {VARIABLE miner.x $x1}
                {VARIABLE miner.y $y1}


                # drain moves ? attacks ? do whatever you want here.
                {VARIABLE miner.moves 0}
                {VARIABLE miner.attacks_left 0}

                # note that if more than one unit was adjacent the first stored is modified and all others just stay where they were
                {FOREACH miner i}
                    [unstore_unit]
                        variable=miner[$i]
                    [/unstore_unit]
                {NEXT i}

                [redraw]
                    clear_shroud=yes
                [/redraw]
            [/command]
        [/set_menu_item]

    [/event]
#enddef
#define ABILITY_FURY
    [dummy]
        id=fury
        name= _ "fury"
        description="This unit can attack another unit after killing an enemy."
    [/dummy] # wmlxgettext: [abilities]
[/abilities]
[event]
    name=die
    first_time_only=no
    [filter_second]
        side=$side_number
        ability=fury
    [/filter_second]

    [store_unit]
        variable=furious
        [filter]
            x,y=$x2,$y2
        [/filter]
    [/store_unit]
    {VARIABLE_OP furious.attacks_left add 1}
    [unstore_unit]
        variable=furious
        {COLOR_HARM}
        text= _ "FURY!"
        find_vacant=no
    [/unstore_unit]
[/event]
[+abilities] # wmlxgettext: [/abilities]
#enddef
#define ABILITY_BLOODLUST NUMBER
    [dummy]
        id=bloodlust
        name= _ "bloodlust ({NUMBER})"
        description="This unit regains the ability to attack and {NUMBER} movement points after killing an enemy."
    [/dummy] # wmlxgettext: [abilities]
[/abilities]
[event]
    name=die
    first_time_only=no
    [filter_second]
        side=$side_number
        ability=bloodlust
    [/filter_second]

    [store_unit]
        variable=bloodlusty
        [filter]
            x,y=$x2,$y2
        [/filter]
    [/store_unit]
    {VARIABLE_OP bloodlusty.attacks_left add 1}
    {VARIABLE_OP bloodlusty.moves add {NUMBER}}
    [unstore_unit]
        variable=bloodlusty
        {COLOR_HARM}
        text= _ "BLOODLUST!"
        find_vacant=no
    [/unstore_unit]
[/event]
[+abilities] # wmlxgettext: [/abilities]
#enddef
#define ABILITY_SPURT
    [dummy]
        id=spurt
        name= _ "spurt"
        description="This unit regains 1 movement point after killing an enemy."
    [/dummy] # wmlxgettext: [abilities]
[/abilities]
[event]
    name=die
    first_time_only=no
    [filter_second]
#        id=second_unit.id
        ability=spurt
    [/filter_second]
    {VARIABLE_OP second_unit.moves add 1}
    [unstore_unit]
        variable=second_unit
        {COLOR_HEAL}
        text= _ "SPURT!"
        find_vacant=no
    [/unstore_unit]
[/event]
[+abilities] # wmlxgettext: [/abilities]
#enddef

#define ABILITY_KAMIKAZE
    [dummy]
        id=kamikaze
        name= _ "kamikaze"
        description="This unit always hits a target when attacking, but it dies instantly."
    [/dummy] # wmlxgettext: [abilities]
[/abilities]

[event]
    name=attack_end
    first_time_only=no
    [filter]
        ability=kamikaze
        x,y=$x1,$y1
    [/filter]
    [kill]
        x,y=$x1,$y1
        animate=no
    [/kill]
[/event]

[+abilities] # wmlxgettext: [/abilities]
#enddef

#define ABILITY_HITANDRUN VALUE
    [dummy]
        id=hitandrun
        name= _ "hit and run ({VALUE})"
        description="This unit gains {VALUE} moves back after attacking, but cannot attack again."
    [/dummy] # wmlxgettext: [abilities]
[/abilities]
[event]
    name=attack_end
    first_time_only=no
    [filter]
        x,y=$x1,$y1
        ability=hitandrun
    [/filter]
    {VARIABLE_OP unit.moves add {VALUE}}
    [unstore_unit]
        variable=unit
        {COLOR_HEAL}
        text= _ "FLEE!"
        find_vacant=no
    [/unstore_unit]
[/event]
[+abilities] # wmlxgettext: [/abilities]
#enddef


#define ABILITY_AWAKE
    [dummy]
        id=i8awake
        name= _ "awaken"
        description="If a friendly adjacent unit with more than one hitpoint at the beginning of the battle dies, it is resurrected, gets +6 experience and remains in battle with one hitpoint. If it dies again (having one hitpoint), it will be killed for sure.
Doesn't work on units attacked with a weapon which has the 'cleave' weapon special."
    [/dummy] # wmlxgettext: [abilities]
[/abilities]

# Attacker is awoken
[event]
    name=attack
    first_time_only=no

    [filter]
        [filter_adjacent]
            is_enemy=no
            ability=i8awake
        [/filter_adjacent]

        [not]
            [filter_wml]
                [status]
                    not_living=yes
                [/status]
            [/filter_wml]
        [/not]
    [/filter]

    [store_unit]
        [filter]
            x,y=$x1,$y1
        [/filter]
        variable=awakememo
    [/store_unit]

    [if]
        [variable]
            name=awakememo.hitpoints
            equals=1
        [/variable]
        [then]
            {CLEAR_VARIABLE awakememo}
        [/then]
    [/if]
[/event]

# Defender is awoken
[event]
    name=attack
    first_time_only=no

    [filter_second]
        [filter_adjacent]
            is_enemy=no
            ability=i8awake
        [/filter_adjacent]

        [not]
            [filter_wml]
                [status]
                    not_living=yes
                [/status]
            [/filter_wml]
        [/not]
    [/filter_second]

    [store_unit]
        [filter]
            x,y=$x2,$y2
        [/filter]
        variable=awakememo
    [/store_unit]

    [if]
        [variable]
            name=awakememo.hitpoints
            equals=1
        [/variable]

        [then]
            {CLEAR_VARIABLE awakememo}
        [/then]
    [/if]
[/event]

[event]
    name=die
    first_time_only=no

    [filter]
        [filter_adjacent]
            is_enemy=no
            ability=i8awake
        [/filter_adjacent]
        [not]
            [filter_wml]
                [status]
                    not_living=yes
                [/status]
            [/filter_wml]
        [/not]
    [/filter]
    [if]
        [variable]
            name=unit.hitpoints
            less_than_equal_to=0
        [/variable]
        [and]
            [variable]
                name=unit.id
                equals=$awakememo.id
            [/variable]
        [/and]
        [then]
            {VARIABLE unit.hitpoints 1}
            {VARIABLE_OP unit.experience add 6}
            {VARIABLE_OP second_unit.experience sub 6}

            [if]
                [variable]
                    name=second_unit.experience
                    less_than=0
                [/variable]
                [then]
                    {VARIABLE second_unit.experience 0}
                [/then]
            [/if]

            [if]
                [variable]
                    name=unit.gender
                    equals="female"
                [/variable]

                [then]
                    [unstore_unit]
                        variable=unit
                        find_vacant=no
                        text= _ "female^awoken"
                        {COLOR_HEAL}
                    [/unstore_unit]
                [/then]
                [else]
                    [unstore_unit]
                        variable=unit
                        find_vacant=no
                        text= _ "awoken"
                        {COLOR_HEAL}
                    [/unstore_unit]
                [/else]
            [/if]

            [unstore_unit]
                variable=second_unit
                find_vacant=no
            [/unstore_unit]
            {CLEAR_VARIABLE awakememo}
        [/then]
    [/if]
[/event]
[+abilities] # wmlxgettext: [/abilities]
#enddef
#define WEAPON_SPECIAL_SWALLOW
    [damage]
        id=swallow
        name= _ "swallow +4"
        name_inactive= _ "swallow +4"
        description={ABILITY_CAPTION (_"Swallow +4")}+_"This unit gains 4 hitpoints added to its current health whenever it kills a living unit."
        description_inactive={ABILITY_CAPTION (_"Swallow +4")}+_"This unit gains 4 hitpoints added to its current health whenever it kills a living unit."
    [/damage]
#enddef

#define SWALLOW_EVENT
    [event]
        name=die
        first_time_only=no

        [filter]
            [not]
                [filter_wml]
                    [status]
                        not_living="yes"
                    [/status]
                [/filter_wml]
            [/not]
        [/filter]

        [filter_second_attack]
            name=fangswyv
        [/filter_second_attack]

        [unstore_unit]
            variable=second_unit
            {COLOR_HEAL}
            text= _ "4"
            find_vacant=no
        [/unstore_unit]

        [object]
            silent=yes
            duration=forever

            [filter]
                x,y=$x2,$y2
            [/filter]

            [effect]
                apply_to=hitpoints
                increase=4
            [/effect]
        [/object]
    [/event]
#enddef
#define ABILITY_TEMPTATION
    [dummy]
        id=temptation
        name= _ "temptation"
        female_name= _ "female^temptation"
        description= _ "This unit makes its enemies of opposite gender infatuated at the beginning of their turn, making them unable to attack, but able to break this charm by fleeing."
    [/dummy]
#enddef
#define TEMPTATION_EVENT
    [event]
        name=turn refresh
        first_time_only=no
        [store_unit]
            [filter]
                gender=male
                [filter_adjacent]
			[filter_side]
			    [enemy_of]
				side=$side_number
			    [/enemy_of]
			[/filter_side]
                    ability=temptation
                    is_enemy=yes
                    gender=female
                [/filter_adjacent]
                [or]
                    gender=female
                    [filter_adjacent]
			    [filter_side]
				[enemy_of]
				    side=$side_number
				[/enemy_of]
			    [/filter_side]
                        ability=temptation
                        is_enemy=yes
                        gender=male
                    [/filter_adjacent]
                [/or]
                [not]
                    race=undead
                [/not]
		side=$side_number
            [/filter]
            kill=no
            variable=tempting_store_youll_want_to_be_there
        [/store_unit]
        {FOREACH tempting_store_youll_want_to_be_there i}
            {VARIABLE tempting_store_youll_want_to_be_there[$i].attacks_left 0}
            [unstore_unit]
                variable=tempting_store_youll_want_to_be_there[$i]
                find_vacant=no
#ifver WESNOTH_VERSION >= 1.13.2
		male_text=_"Infatuated"
		female_text=_"female^Infatuated"

#else
		text=_"Infatuated"
#endif
		{COLOR_HARM}
            [/unstore_unit]
        {NEXT i}
        {CLEAR_VARIABLE tempting_store_youll_want_to_be_there}
    [/event]
#enddef
#define ABILITY_KILLHUNGER NUMBER
    # Canned definition of the Klllhunger ability to be included in an
    # [abilities] clause.
    [dummy]
        id=klllhunger{NUMBER}
        name= _ "klllhunger ({NUMBER})"
        female_name= _ "female^klllhunger ({NUMBER})"
        description=_ "This unit heals by {NUMBER} hitpoint whenever it kills a unit, except units that are immune to plague."
    [/dummy]
[/abilities]
[event]
    id=ability_klllhunger_die
    name=die
    first_time_only=no

    [filter]
        [not]
            [filter_wml]
                [status]
                    unplagueable="yes"
                [/status]
            [/filter_wml]
        [/not]
    [/filter]

    [filter_second]
        ability=klllhunger{NUMBER}
    [/filter_second]
	[heal_unit]
		[filter]
                    x,y=$x2,$y2
		[/filter]
		amount={NUMBER}
		animate=yes
		restore_statuses=no
	[/heal_unit]
[/event]
[+abilities]
#enddef
#define ABILITY_TOUGH VALUE
    # Canned definition of the Tough ability to be included in an [abilities]
    # clause.
    [resistance]
        id=tough
        add={VALUE}
        max_value=60
#        apply_to=blade,pierce,impact
        name= _ "tough ({VALUE})"
        female_name= _ "female^tough ({VALUE})"
        description= _ "When defending, this unit’s physical resistances are increased by {VALUE}%. Vulnerabilities are affected."
        affect_self=yes
        active_on=defense
        [filter_base_value]
            less_than=60
        [/filter_base_value]
    [/resistance]
#enddef
#define SPECIAL_NOTES_BLITZ
_" This unit is able to grant the skirmisher ability to allied units that stand next to it on start of his turn." #enddef

#define SPECIAL_NOTES_BATTLE_TUTOR
_" The ability to teach battle experience to adjacent allied units allows them to earn experience points equivalent of the second unit level whenever the tutor attacks with his melee attack and hits at least once." #enddef

# wmllint: unbalanced-on
#define ABILITY_BLITZ
    [leadership]
        id=blitz
        name= _ "blitz"
        description= _ "Allies that start their turn adjacent to this unit are granted Skirmisher for that turn."
        affect_self=no
        affect_allies=yes
        value=0
    [/leadership]
[/abilities]
[event]
    name=turn refresh
    first_time_only=no

    [store_unit]
        [filter]
            side=$side_number
            [and]
                [filter_adjacent]
                    ability=blitz
                    is_enemy=no
                [/filter_adjacent]
            [/and]
            [not]
                ability=skirmisher
            [/not]
        [/filter]
        variable=blitzed
    [/store_unit]

    {FOREACH blitzed i_temp}
        [set_variables]
            name=blitzed[$i_temp].abilities
            mode=append
            [value]
                {ABILITY_SKIRMISHER}
            [/value]
        [/set_variables]

        [set_variable]
            name=blitzed[$i_temp].status.blitzed
            value=yes
        [/set_variable]

        [unstore_unit]
            variable=blitzed[$i_temp]
            find_vacant=no
        [/unstore_unit]
    {NEXT i_temp}

    {CLEAR_VARIABLE blitzed}
    [redraw][/redraw]
[/event]

[event]
    name=side turn end,time over,enemies defeated,defeat,victory
    first_time_only=no

    [store_unit]
        [filter]
            [filter_wml]
                [status]
                    blitzed=yes
                [/status]
            [/filter_wml]
        [/filter]
        variable=blitzed
    [/store_unit]

    {FOREACH blitzed i_temp}
        {VARIABLE j_temp $blitzed[$i_temp].abilities.skirmisher.length}
        [while]
            {VARIABLE_CONDITIONAL j_temp greather_than 0}
            [do]
                [if]
                    # this is to prevent that distract or similar gets removed
                    [variable]
                        name=blitzed[$i_temp].abilities.skirmisher[$j_temp].id
                        equals="skirmisher"
                    [/variable]
                    [then]
                        [clear_variable]
                            name=blitzed[$i_temp].abilities.skirmisher[$j_temp]
                        [/clear_variable]
                    [/then]
                [/if]
                {VARIABLE_OP j_temp sub 1}
            [/do]
        [/while]

        [clear_variable]
            name=blitzed[$i_temp].status.blitzed
        [/clear_variable]

        [unstore_unit]
            variable=blitzed[$i_temp]
            find_vacant=no
        [/unstore_unit]
    {NEXT i_temp}

    {CLEAR_VARIABLE blitzed,j_temp}
[/event]
[+abilities]
#enddef

#define WEAPON_SPECIAL_BATTLETUTOR
    [drains]
        id=battletutor
        name= _ "battle tutor"
        name_inactive= _ "battle tutor"
        description= _ "This unit is able to teach its battle skills to adjacent units of lower level while using this weapon providing a small boost to experience earned in battle."
        description_inactive= _ "This unit is able to teach its battle skills to adjacent units of lower level while using this weapon providing a small boost to experience earned in battle."
        value=33
    [/drains]
#enddef

#define WEAPON_SPECIAL_BATTLETUTOR_EVENT
    [event]
        id=battletutor_effect
        name=attack end
        first_time_only=no

        [filter_condition]
            {VARIABLE_CONDITIONAL second_unit.level less_than_equal_to $unit.level}
        [/filter_condition]

        [filter_attack]
            special=battletutor
        [/filter_attack]

        [if]
            {VARIABLE_CONDITIONAL second_unit.level equals 0}
            [then]
                {VARIABLE battletutor_value $unit.level}
            [/then]
            [else]
                {VARIABLE battletutor_value $second_unit.level}
                {VARIABLE_OP battletutor_value multiply $unit.level}
            [/else]
        [/if]

        {VARIABLE_OP battletutor_value sub 1}

        [if]
            [not]
                [have_unit]
                    id=$second_unit.id
                [/have_unit]
            [/not]
            [then]
                {VARIABLE_OP battletutor_value add $second_unit.level}
            [/then]
        [/if]

        [store_unit]
            [filter]
                [filter_adjacent]
                    id=$unit.id
                    is_enemy=no
                [/filter_adjacent]
            [/filter]
            variable=adjacent_units
        [/store_unit]

        {FOREACH adjacent_units i_temp}
            [if]
                {VARIABLE_CONDITIONAL adjacent_units[$i_temp].level less_than $unit.level}
                [then]
                    {VARIABLE_OP adjacent_units[$i_temp].experience add "$(abs($battletutor_value-$adjacent_units[$i_temp].level))"}
                    [unstore_unit]
                        variable=adjacent_units[$i_temp]
                        fire_event=yes
                    [/unstore_unit]
                [/then]
            [/if]
        {NEXT i_temp}

        [floating_text]
            text="<span color='lightblue'>" + _ "$battletutor_value XP" + "</span>"
            x,y=$unit.x,$unit.y
        [/floating_text]
    [/event]
#enddef

#define ABILITY_BLAZE_OF_GLORY NUMBER
    [damage]
        id=blaze of glory{NUMBER}
        name= _ "blaze of glory ({NUMBER})"
        description="this unit carries plenty of fire-causing things on him. On death, those things explode, dealing {NUMBER} damage to adjacent enemy units."
    [/damage]
    [/abilities]
    [event]
        name=last_breath
        first_time_only=no
        [filter]
            ability=blaze of glory{NUMBER}
        [/filter]
        [harm_unit]
            [filter]
                [filter_adjacent]
                    x,y=$x1,$y1
                [/filter_adjacent]
                [filter_side]
                    [enemy_of]
                        side=$unit.side
                    [/enemy_of]
                [/filter_side]
            [/filter]
            amount={NUMBER}
#            alignment=$unit.alignment
            damage_type=fire
            experience=no
            fire_event=yes
            poisoned=no
            slowed=no
#	    animate=yes
        [/harm_unit] 
    [/event]
    [+abilities]
#enddef

#define ABILITY_ROCK_HEALING VALUE
    [regenerate]
        [filter_self]
            [filter_location]
                terrain=Uh^*,Ms^*,Mm^*,Md^*,Hh^*,Ha^*,Hd^*,Uu^*,Ur^*,Ql^*,Wyu^*,Wyur^*,Wyuh
            [/filter_location]
        [/filter_self]
        value={VALUE}
        affect_self="yes"
        name=_ "assimilate rock +{VALUE}"
        description= _ "The unit will heal itself {VALUE} HP per turn on mountain, cave and hill terrains."
    [/regenerate]
#enddef

#define SPECIAL_NOTES_UNSLOWABLE
_ "If this unit is slowed, the effect wears off at the end of the attack."#enddef

#define ABILITY_IMMUNE_TO_SLOW
    [dummy]
        id="immune to slow"
        name= ""
        description= ""
    [/dummy]
[/abilities]
  [event]
      name=attack end
      first_time_only=no
     [filter_attack]
         special=slow
     [/filter_attack]
     [filter_second]
         ability="immune to slow"
     [/filter_second]
	{CLEAR_VARIABLE second_unit.status.slowed}
         [unstore_unit]
		variable=second_unit
		find_vacant=no
	[/unstore_unit]
  [/event]
  [event]
      name=attack end
      first_time_only=no
     [filter_second_attack]
         special=slow
     [/filter_second_attack]
     [filter]
         ability="immune to slow"
     [/filter]
	{CLEAR_VARIABLE unit.status.slowed}
         [unstore_unit]
		variable=unit
		find_vacant=no
	[/unstore_unit]
  [/event]
[+abilities]
  #enddef

# wmllint: unbalanced-off
#define SPECIAL_NOTES_STEAL
_" This unit is able to hide not only in deep water, but also in swamps."#enddef

#define SPECIAL_NOTES_ROTM_HEALS
_" This unit may heal another by up to 4 HP per turn, or cure the effects of poison."#enddef

#define SPECIAL_NOTES_RECOVERY 
_" This unit may recover by up to 4 HP per turn. If poisoned, it will recover from the poisoning instead."#enddef 

#define SPECIAL_NOTES_TREEWALK
_ "This unit may teleport between any two great trees using one of its moves"#enddef

#define SPECIAL_NOTES_TERROR
_ "This unit can frighten enemy units that are next to it, making them fight worse. Adjacent enemy units of lower level will do less damage in battle. When an enemy unit of the same or lower level is adjacent and engages in combat, its attacks do 15% less damage times the difference in their levels + 15%."#enddef

#define SPECIAL_NOTES_SYLVAN_SPARK
_ "While in vegetated terrains, the unit will heal itself 5 hp per turn. If it is poisoned, it will remove the poison instead of healing."#enddef

#define ABILITY_SWAMP_PROWL
    [hides]
        id=ROLswamp_prowl
        name= _ "swamp prowl"
        name_inactive= _ "swamp prowl"
        description= _ "This unit can hide in swamps, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in a swamp hex, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        description_inactive= _ "This unit can hide in swamps, and remain undetected by its enemies.

Enemy units cannot see this unit while it is in a swamp hex, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."
        affect_self=yes
        [filter_self]
            [filter_location]
                terrain=Chs,Khs,Ss,Ss^Vhs,Ss^Vm
            [/filter_location]
        [/filter_self]
    [/hides]
#enddef

#define ABILITY_TWILIGHTSTALK    
   [hides]        
	id=ROLtwilightstalk        
	name= _ "twilightstalk"        
	female_name= _ "twilightstalk"               
	description= _ "The unit becomes invisible during dawn and dusk, hiding in long shadows created by the sun near the horizont.
	Enemy units cannot see this unit during dawn or dusk, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."        
	description_inactive= _ "The unit becomes invisible during dawn and dusk, hiding in long shadows created by the sun near the horizont.
	Enemy units cannot see this unit during dawn or dusk, except if they have units next to it. Any enemy unit that first discovers this unit immediately loses all its remaining movement."        
	affect_self=yes        
	[filter_self]            
	   [filter_location]                
		time_of_day=neutral            
	   [/filter_location]        
	[/filter_self]    
   [/hides]
#enddef

#define SPECIAL_NOTES_TWILIGHTSTALK
_ " This unit becomes invisible during dawn and dusk, hiding in long shadows created by the sun near the horizont."#enddef

#define SPECIAL_NOTES_POISONING
    _"When this unit dies all enemy units around it will become poisoned."#enddef

#define ABILITY_POISONING
   [dummy]
      id=ROLpoisoning
      name= _ "poisoning"
      description= _ "When this unit is destroyed, a toxic gas is unleashed, poisonning all surrounding living units in the process. Non-living units are immune."
   [/dummy]

[/abilities]
[event]
   name=die
   first_time_only=no

    [filter]
        ability=poisoning
    [/filter]

    [store_unit]
        [filter]
            [filter_adjacent]
                x,y=$x1,$y1
            [/filter_adjacent]
        [not]
            [filter_wml]
                [status]
                    not_living="yes"
                [/status]
            [/filter_wml]
        [/not]
	[and]
	   [not]
	      side=$unit.side
	   [/not]
	[/and]
        [/filter]
       
        variable=units
   	kill=no
    [/store_unit]

    {FOREACH units i}
      [set_variable]
         name=units[$i].status.poisoned
         value=yes
      [/set_variable]
      [unstore_unit]
          variable=units[$i]
          find_vacant=no
          text= _ "poisoned"
          {COLOR_HARM}
      [/unstore_unit]

    {NEXT i}
    {CLEAR_VARIABLE units}

           [kill]
                x,y=$x1,$y1
           [/kill]   

[/event]
[+abilities]

#enddef

########################

# Be careful with that "attack[1]", it means your Relentless weapon must be your unit's second weapon!
# If you want it to be first, use "attack[0]" instead, or third would be "attack[2]", etc.
# You could also do it with the FOREACH macro and "attack[i]" for every attack.


#define SPECIAL_NOTES_RELENTLESS
    _ "If this unit hits an enemy with the its relentless attack all following strikes will have a 100% chance of hitting." #enddef

#define WEAPON_SPECIAL_RELENTLESS ATTID

   [dummy]
      id=relentless
      name= _ "relentless"
      description= _ "As soon as a strike from a relentless attack hits, all the remaining strikes have a 100% chance to hit. "
   [/dummy]

[/specials]
[/attack]
    [event]
        name=attacker hits
        first_time_only=no

        [filter_attack]
            special=relentless
        [/filter_attack]

	[store_unit]
	   [filter]
		id=$unit.id
	   [/filter]
	   variable=relenter
	[/store_unit]

		    [set_variables]
                        name=relenter.attack[{ATTID}].specials.original_chance_to_hit
                        value=$relenter.attack[{ATTID}].specials.chance_to_hit
                    [/set_variables]


                    [set_variables]
                        name=relenter.attack[{ATTID}].specials.chance_to_hit

                        [value]
                            id=forced_cth
                            value=100
                            cumulative=no
                        [/value]
                    [/set_variables]

                [unstore_unit]
                    variable=relenter
                    find_vacant=no
                [/unstore_unit]

                [event]
                    name=attack end
                    delayed_variable_substitution=yes


			[store_unit]
			   [filter]
				id=$unit.id
			   [/filter]
			   variable=relenterend
			[/store_unit]

                        {CLEAR_VARIABLE relenterend.attack[{ATTID}].specials.chance_to_hit}

                        [set_variables]
                            name=relenterend.attack[{ATTID}].specials.chance_to_hit
                            value=relenterend.attack[{ATTID}].specials.original_chance_to_hit
                        [/set_variables]

                        {CLEAR_VARIABLE relenterend.attack[{ATTID}].specials.original_chance_to_hit}


                    [unstore_unit]
                        variable=relenterend
                        find_vacant=no
                    [/unstore_unit]
                [/event]

    [/event]

    [event]
        name=defender hits
        first_time_only=no

        [filter_second_attack]
            special=relentless
        [/filter_second_attack]


                    [if]
                        [variable]
                            name=second_unit.attack[{ATTID}].specials.chance_to_hit.length
                            greater_than=0
                        [/variable]

                        [then]
                            [set_variables]
                                name=second_unit.attack[{ATTID}].specials.original_chance_to_hit
                                to_variable=second_unit.attack[{ATTID}].specials.chance_to_hit
                            [/set_variables]

                            {CLEAR_VARIABLE second_unit.attack[{ATTID}].specials.chance_to_hit}
                        [/then]
                    [/if]

                    [set_variables]
                        name=second_unit.attack[{ATTID}].specials.chance_to_hit

                        [value]
                            id=forced_cth
			    #chance_to_hit
                            value=100
                            cumulative=no
                        [/value]
                    [/set_variables]

                [unstore_unit]
                    variable=second_unit
                    find_vacant=no
                [/unstore_unit]

                [event]
                    name=attack end
                    delayed_variable_substitution=yes

                        {CLEAR_VARIABLE second_unit.attack[{ATTID}].specials.chance_to_hit}

                        [set_variables]
                            name=second_unit.attack[$i].specials.chance_to_hit
                            to_variable=second_unit.attack[{ATTID}].specials.original_chance_to_hit
                        [/set_variables]

                        {CLEAR_VARIABLE second_unit.attack[{ATTID}].specials.original_chance_to_hit}

                    [unstore_unit]
                        variable=second_unit
                        find_vacant=no
                    [/unstore_unit]
                [/event]

    [/event]

[+attack]
[+specials]

#enddef
#define ABILITY_ABSORB VALUE
    [dummy]
        id=absorb 1
        name= _ "absorbs (1)"
        description= _ "When this unit is hit, it takes its regular damage, but heals 1 HP after it."
    [/dummy]
#enddef
#define ABILITY_DESPERATE VALUE
    # Canned definition of the Desperate ability to be included in an
    # [abilities] clause.
    [leadership]
        id=desperate
        value={VALUE}
        cumulative=no
        name= _ "desperate ({VALUE}%)"
        female_name= _ "female^desperate ({VALUE}%)"
        description= _ "This unit's attacks do {VALUE}% more damage when it's health is below 50%."
        affect_self=yes
        affect_allies=no
        affect_enemies=no
        [filter_self]
#           [filter]
               formula="(($this_unit.max_hitpoints -1+1) / ($this_unit.hitpoints -1+1)) > 2"
#	   [/filter]
        [/filter_self]
    [/leadership]
#enddef
